{"version":3,"file":"ks-page-order-end.entry.system.js","sources":["src/global/data/orderEnd.ts","src/components/pages/order/orderEnd.css?tag=ks-page-order-end","src/components/pages/order/orderEnd.tsx"],"sourcesContent":["import { createStore } from \"@stencil/store\";\nimport { OrderData, OrderDetailsData } from \"./order\";\n\nexport const orderSuccess = createStore({\n    eventId: \"\",\n\n    heading: \"\",\n    message: \"\",\n    homepage: \"\",\n\n} as OrderSuccessData);\n\nexport interface OrderSuccessData {\n    eventId: string;\n\n    heading: string;\n    message: string;\n    homepage: string;\n\n    verify: string;\n    error: boolean;\n    errorHeading: string;\n    errorMessage: string;\n\n    orderId: string;\n    orderString: string;\n    orderLink: string;\n    \n    order: OrderData;\n    details: OrderDetailsData;\n}","ks-page-order-end .card {\n    display: block;\n    padding: 0px;\n    box-sizing: border-box;\n\n    max-width: 800px;\n    width: 100%;\n    margin: auto;\n    padding: 50px 20px;\n\n    color: var(--card-text-color);\n    text-align: center;\n}\n\nks-page-order-end .card ks-icon {\n    margin-right: 10px;\n}\n\nks-page-order-end .card h1 {\n    font-size: 22px;\n    font-weight: 700;\n}\n\nks-page-order-end .card .payment {\n    margin-top: 20px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-wrap: wrap;\n\n    opacity: 1;\n    transition: opacity ease 0.3s;\n}\n\nks-page-order-end .card .loader {\n    position: relative;\n    height: 40px;\n    margin-top: 20px;\n}\n\nks-page-order-end .card .buttons {\n    margin-top: 10px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-wrap: wrap;\n}\n\nks-page-order-end .card .buttons ks-button {\n    margin: 5px;\n}\n\n\nks-page-order-end .card h2 {\n    margin: 20px auto 5px auto;\n    font-weight: 700;\n}","import { Component, h, Prop, State } from '@stencil/core';\nimport { orderSuccess, OrderSuccessData } from \"../../../global/data/orderEnd\";\nimport Fetch from '../../../global/functions/fetch';\n\n@Component({\n    tag: 'ks-page-order-end',\n    styleUrl: 'orderEnd.css'\n})\nexport class PageOrderEnd {\n    @Prop() skipbase: boolean;\n    @Prop() commonData: string;\n    @Prop() commonDynamicData: string;\n\n    @Prop() orderData: string;\n    @State() displayPayment: boolean = true;\n    @State() paymentOpacity: boolean = true;\n\n    componentWillLoad() {\n        const orderDataElement = document.getElementById(this.orderData);\n\t\tconst orderData = JSON.parse(orderDataElement.innerHTML) as OrderSuccessData;\n\n        Object.keys(orderData).map(key => {\n\t\t\torderSuccess.set(key as keyof OrderSuccessData, orderData[key]);\n\t\t});\n\n        this.track();\n\n\n        const verify = orderSuccess.get('verify');\n        const order = orderSuccess.get('orderId');\n\n        if(verify) {\n            this.displayPayment = false;\n            this.paymentOpacity = false;\n\n            this.verify(verify, order);\n\n            setTimeout(()=>{\n                this.displayPayment = true;\n            }, 3000);\n\n            setTimeout(()=>{\n                this.paymentOpacity = true;\n            }, 3100);\n        }\n    }\n\n    verify(verify, order) {\n        setTimeout(()=>{\n            Fetch(verify + `&order=${order}`)\n                .then(response => {\n                    response.text()\n                        .then(text=>{\n                            if(text == \"OK\")\n                                document.location.reload();\n                            else this.verify(verify, order);\n                        })\n                        .catch(()=> this.verify(verify, order))\n                })\n                .catch(()=> this.verify(verify, order))\n        }, 2000);\n    }\n\n    track() {\n        /*if(!orderSuccess.get('error'))\n            window.dataLayer?.push({\n                currency: 'PLN',\n                transaction_id: orderSuccess.get('orderID'),\n                value: orderSuccess.get('orderValue'),\n                items: Object.entries(orderSuccess.get('products')).map( ([id, product]) => { return {\n                    item_id: id,\n                    item_name: product.name,\n                    currency: 'PLN',\n                    price: product.price,\n                    quantity: product.amount\n                }}),\n            });\n        */\n    }\n\n\trender() {\n\t\treturn <ks-page-base skipbase={this.skipbase} commonData={this.commonData} commonDynamicData={this.commonDynamicData}>\n            <div class=\"card\">\n                <h1 class=\"heading\">{orderSuccess.get('heading')}</h1>\n\n                <section class=\"content\">\n                    <div class=\"message\">{orderSuccess.get('message')}</div>\n\n                    {orderSuccess.get('error') ? [\n                        <h2>{orderSuccess.get('errorHeading')}</h2>,\n                        <div>{orderSuccess.get('errorMessage')}</div>\n                    ] : null}\n\n                    {orderSuccess.get('verify') ?\n                        <div class=\"loader\">\n                            <ks-loader dark />\n                        </div> \n                    : null}\n\n                    <div class=\"payment\" style={{display: this.displayPayment ? null : \"none\", opacity: this.paymentOpacity ? null : \"0\"}}>\n                        <slot/>\n                    </div>\n\n                    <div class=\"buttons\">\n                        {orderSuccess.get('orderString') ? \n                            <ks-button round link={orderSuccess.get('orderLink')} name={orderSuccess.get('orderString')} />\n                        : null}\n                        \n                        <ks-button round link=\"/\" name={orderSuccess.get('homepage')} />\n                    </div>\n                </section>\n            </div>\n        </ks-page-base>;\n\t}\n}\n"],"names":[],"mappings":"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"}
import{c as a}from"./cart-3ea22f3a.js";import{f as n,j as t}from"./fetch-1f8a9006.js";import{D as i}from"./dataLayer-b17c3f4e.js";async function o(n){var t;const o=null===(t=a.get("products"))||void 0===t?void 0:t[n];o&&i.removeFromCart(o);const c=await b(a.get("api").productRemove,{id:n});c&&(0==c.products.length?document.location.reload():v("Błąd usuwania produktu",c,(async a=>{h(a)})));const s=document.querySelector(`ks-cart-product[ikey="${n}"]`);s&&s.ResetLoading()}var c=new AbortController;async function s(n,t){let i=null;c.abort(),c=new AbortController;const o=await b(a.get("api").productCount,{id:n,ilosc:t.toString()},c.signal);return o&&v("Błąd ilości produktu",o,(async a=>{var n,t;"error"in a?(A().show("Błąd ilości produktu",a.error.message),i=null!==(t=null===(n=null==a?void 0:a.error)||void 0===n?void 0:n.maxCount)&&void 0!==t?t:null):h(a),"discount"in a==0&&p()})),i}async function e(n){a.set("loadingDeals",!0);const t=await b(a.get("api").addDeal,{id:n});a.set("loadingDeals",!1),t&&!("error"in t)?await h(t):A().show("Błąd dodawania gratisu",t.error.message)}async function u(n){k("ks-cart-select-shipping"),k("ks-cart-select-payment"),h(await b(a.get("api").countryChange,{data:n})),g("ks-cart-select-shipping"),g("ks-cart-select-payment")}async function d(n){k("ks-cart-select-payment"),h(await b(a.get("api").shippingChange,{data:n.toString()})),g("ks-cart-select-payment")}async function r(n){h(await b(a.get("api").paymentChange,{data:n.toString()}))}async function l(){h(await b(a.get("api").discountRemove)),p()}function p(){a.set("discount",{})}async function f(n){v("Błąd dodawania kodu",await b(a.get("api").discountCode,{data:n}),(a=>{h(a)})),g("ks-cart-discount-code")}async function y(n){const t=await b(a.get("api").discountPoints,{data:n.toString()});!function(){const a=document.querySelectorAll("ks-cart-discount-container ks-cart-heading");let n=0;2==a.length&&(n=a[1].getBoundingClientRect().top-a[0].getBoundingClientRect().top),n&&window.scrollBy(0,-n)}(),h(t),g("ks-cart-discount-points")}async function m(n){const i=a.get("api").easyprotectChange;j(),await t(i,n).then((a=>a.json())).then((a=>h(a))),B()}async function w(t){const i=a.get("api").easyprotectRemove;j(),await n(i,{id:t}).then((a=>a.json())).then((a=>h(a))),B()}function k(a){const n=document.querySelector(a);n&&"StartLoading"in n&&n.StartLoading()}function g(a){const n=document.querySelector(a);n&&"ResetLoading"in n&&n.ResetLoading()}async function v(a,n,t){"message"in n?(A().show(a,n.message),delete n.message,setTimeout((()=>{t(n)}),200)):t(n)}async function b(a,t,i){return j(),n(a,t,i).then((a=>a.json())).then((a=>(B(),a))).catch((a=>(B(),"AbortError"!=a.name&&document.querySelector("ks-error-popup").show(a),{})))}function h(n){Object.keys(n).map((t=>{a.set(t,n[t])})),"discount"in n==0&&p()}function j(){a.set("loading",a.get("loading")+1)}function B(){a.get("loading")>0&&a.set("loading",a.get("loading")-1)}function A(){return document.querySelector("ks-message-popup")}export{e as a,y as b,u as c,f as d,m as e,l as f,w as g,s as h,r as p,o as r,d as s,h as u}
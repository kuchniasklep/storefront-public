{"version":3,"names":["orderSuccess","createStore","eventId","heading","message","homepage","orderEndCss","PageOrderEnd","exports","class_1","hostRef","this","displayPayment","paymentOpacity","prototype","componentWillLoad","_this","orderDataElement","document","getElementById","orderData","JSON","parse","innerHTML","Object","keys","map","key","set","track","verify","get","order","setTimeout","Fetch","concat","then","response","text","location","reload","catch","render","h","skipbase","commonData","commonDynamicData","class","dark","style","display","opacity","round","link","name"],"sources":["src/global/data/orderEnd.ts","src/components/pages/order/orderEnd.css?tag=ks-page-order-end","src/components/pages/order/orderEnd.tsx"],"sourcesContent":["import { createStore } from \"@stencil/store\";\nimport { OrderData, OrderDetailsData } from \"./order\";\n\nexport const orderSuccess = createStore({\n    eventId: \"\",\n\n    heading: \"\",\n    message: \"\",\n    homepage: \"\",\n\n} as OrderSuccessData);\n\nexport interface OrderSuccessData {\n    eventId: string;\n\n    heading: string;\n    message: string;\n    homepage: string;\n\n    verify: string;\n    error: boolean;\n    errorHeading: string;\n    errorMessage: string;\n\n    orderId: string;\n    orderString: string;\n    orderLink: string;\n    \n    order: OrderData;\n    details: OrderDetailsData;\n}","ks-page-order-end .card {\n    display: block;\n    padding: 0px;\n    box-sizing: border-box;\n\n    max-width: 800px;\n    width: 100%;\n    margin: auto;\n    padding: 50px 20px;\n\n    color: var(--card-text-color);\n    text-align: center;\n}\n\nks-page-order-end .card ks-icon {\n    margin-right: 10px;\n}\n\nks-page-order-end .card h1 {\n    font-size: 22px;\n    font-weight: 700;\n}\n\nks-page-order-end .card .payment {\n    margin-top: 20px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-wrap: wrap;\n\n    opacity: 1;\n    transition: opacity ease 0.3s;\n}\n\nks-page-order-end .card .loader {\n    position: relative;\n    height: 40px;\n    margin-top: 20px;\n}\n\nks-page-order-end .card .buttons {\n    margin-top: 10px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-wrap: wrap;\n}\n\nks-page-order-end .card .buttons ks-button {\n    margin: 5px;\n}\n\n\nks-page-order-end .card h2 {\n    margin: 20px auto 5px auto;\n    font-weight: 700;\n}","import { Component, h, Prop, State } from '@stencil/core';\nimport { orderSuccess, OrderSuccessData } from \"../../../global/data/orderEnd\";\nimport Fetch from '../../../global/functions/fetch';\n\n@Component({\n    tag: 'ks-page-order-end',\n    styleUrl: 'orderEnd.css'\n})\nexport class PageOrderEnd {\n    @Prop() skipbase: boolean;\n    @Prop() commonData: string;\n    @Prop() commonDynamicData: string;\n\n    @Prop() orderData: string;\n    @State() displayPayment: boolean = true;\n    @State() paymentOpacity: boolean = true;\n\n    componentWillLoad() {\n        const orderDataElement = document.getElementById(this.orderData);\n\t\tconst orderData = JSON.parse(orderDataElement.innerHTML) as OrderSuccessData;\n\n        Object.keys(orderData).map(key => {\n\t\t\torderSuccess.set(key as keyof OrderSuccessData, orderData[key]);\n\t\t});\n\n        this.track();\n\n\n        const verify = orderSuccess.get('verify');\n        const order = orderSuccess.get('orderId');\n\n        if(verify) {\n            this.displayPayment = false;\n            this.paymentOpacity = false;\n\n            this.verify(verify, order);\n\n            setTimeout(()=>{\n                this.displayPayment = true;\n            }, 3000);\n\n            setTimeout(()=>{\n                this.paymentOpacity = true;\n            }, 3100);\n        }\n    }\n\n    verify(verify, order) {\n        setTimeout(()=>{\n            Fetch(verify + `&order=${order}`)\n                .then(response => {\n                    response.text()\n                        .then(text=>{\n                            if(text == \"OK\")\n                                document.location.reload();\n                            else this.verify(verify, order);\n                        })\n                        .catch(()=> this.verify(verify, order))\n                })\n                .catch(()=> this.verify(verify, order))\n        }, 2000);\n    }\n\n    track() {\n        /*if(!orderSuccess.get('error'))\n            window.dataLayer?.push({\n                currency: 'PLN',\n                transaction_id: orderSuccess.get('orderID'),\n                value: orderSuccess.get('orderValue'),\n                items: Object.entries(orderSuccess.get('products')).map( ([id, product]) => { return {\n                    item_id: id,\n                    item_name: product.name,\n                    currency: 'PLN',\n                    price: product.price,\n                    quantity: product.amount\n                }}),\n            });\n        */\n    }\n\n\trender() {\n\t\treturn <ks-page-base skipbase={this.skipbase} commonData={this.commonData} commonDynamicData={this.commonDynamicData}>\n            <div class=\"card\">\n                <h1 class=\"heading\">{orderSuccess.get('heading')}</h1>\n\n                <section class=\"content\">\n                    <div class=\"message\">{orderSuccess.get('message')}</div>\n\n                    {orderSuccess.get('error') ? [\n                        <h2>{orderSuccess.get('errorHeading')}</h2>,\n                        <div>{orderSuccess.get('errorMessage')}</div>\n                    ] : null}\n\n                    {orderSuccess.get('verify') ?\n                        <div class=\"loader\">\n                            <ks-loader dark />\n                        </div> \n                    : null}\n\n                    <div class=\"payment\" style={{display: this.displayPayment ? null : \"none\", opacity: this.paymentOpacity ? null : \"0\"}}>\n                        <slot/>\n                    </div>\n\n                    <div class=\"buttons\">\n                        {orderSuccess.get('orderString') ? \n                            <ks-button round link={orderSuccess.get('orderLink')} name={orderSuccess.get('orderString')} />\n                        : null}\n                        \n                        <ks-button round link=\"/\" name={orderSuccess.get('homepage')} />\n                    </div>\n                </section>\n            </div>\n        </ks-page-base>;\n\t}\n}\n"],"mappings":"kPAGO,IAAMA,EAAeC,EAAY,CACpCC,QAAS,GAETC,QAAS,GACTC,QAAS,GACTC,SAAU,KCRd,IAAMC,EAAc,o+B,ICQPC,EAAYC,EAAA,+BAJzB,SAAAC,EAAAC,G,UAUaC,KAAcC,eAAY,KAC1BD,KAAcE,eAAY,IAmGtC,CAjGGJ,EAAAK,UAAAC,kBAAA,eAAAC,EAAAL,KACI,IAAMM,EAAmBC,SAASC,eAAeR,KAAKS,WAC5D,IAAMA,EAAYC,KAAKC,MAAML,EAAiBM,WAExCC,OAAOC,KAAKL,GAAWM,KAAI,SAAAC,GAChC3B,EAAa4B,IAAID,EAA+BP,EAAUO,GAC3D,IAEMhB,KAAKkB,QAGL,IAAMC,EAAS9B,EAAa+B,IAAI,UAChC,IAAMC,EAAQhC,EAAa+B,IAAI,WAE/B,GAAGD,EAAQ,CACPnB,KAAKC,eAAiB,MACtBD,KAAKE,eAAiB,MAEtBF,KAAKmB,OAAOA,EAAQE,GAEpBC,YAAW,WACPjB,EAAKJ,eAAiB,I,GACvB,KAEHqB,YAAW,WACPjB,EAAKH,eAAiB,I,GACvB,K,GAIXJ,EAAAK,UAAAgB,OAAA,SAAOA,EAAQE,GAAf,IAAAhB,EAAAL,KACIsB,YAAW,WACPC,EAAMJ,EAAS,UAAAK,OAAUH,IACpBI,MAAK,SAAAC,GACFA,EAASC,OACJF,MAAK,SAAAE,GACF,GAAGA,GAAQ,KACPpB,SAASqB,SAASC,cACjBxB,EAAKc,OAAOA,EAAQE,EAC7B,IACCS,OAAM,WAAK,OAAAzB,EAAKc,OAAOA,EAAQE,EAApB,GACpB,IACCS,OAAM,WAAK,OAAAzB,EAAKc,OAAOA,EAAQE,EAApB,G,GACjB,I,EAGPvB,EAAAK,UAAAe,MAAA,W,EAiBHpB,EAAAK,UAAA4B,OAAA,WACC,OAAOC,EAAA,gBAAAhB,IAAA,2CAAciB,SAAUjC,KAAKiC,SAAUC,WAAYlC,KAAKkC,WAAYC,kBAAmBnC,KAAKmC,mBACzFH,EAAK,OAAAhB,IAAA,2CAAAoB,MAAM,QACPJ,EAAI,MAAAhB,IAAA,2CAAAoB,MAAM,WAAW/C,EAAa+B,IAAI,YAEtCY,EAAS,WAAAhB,IAAA,2CAAAoB,MAAM,WACXJ,EAAK,OAAAhB,IAAA,2CAAAoB,MAAM,WAAW/C,EAAa+B,IAAI,YAEtC/B,EAAa+B,IAAI,SAAW,CACzBY,EAAA,UAAK3C,EAAa+B,IAAI,iBACtBY,EAAA,WAAM3C,EAAa+B,IAAI,kBACvB,KAEH/B,EAAa+B,IAAI,UACdY,EAAK,OAAAI,MAAM,UACPJ,EAAW,aAAAK,KAAI,QAErB,KAEFL,EAAA,OAAAhB,IAAA,2CAAKoB,MAAM,UAAUE,MAAO,CAACC,QAASvC,KAAKC,eAAiB,KAAO,OAAQuC,QAASxC,KAAKE,eAAiB,KAAO,MAC7G8B,EAAA,QAAAhB,IAAA,8CAGJgB,EAAK,OAAAhB,IAAA,2CAAAoB,MAAM,WACN/C,EAAa+B,IAAI,eACdY,EAAA,aAAWS,MAAM,KAAAC,KAAMrD,EAAa+B,IAAI,aAAcuB,KAAMtD,EAAa+B,IAAI,iBAC/E,KAEFY,EAAA,aAAAhB,IAAA,2CAAWyB,MAAM,KAAAC,KAAK,IAAIC,KAAMtD,EAAa+B,IAAI,iB,WApGhD,I","ignoreList":[]}
{"version":3,"names":["OrderForm","exports","class_1","prototype","render","_this","this","h","action","method","enctype","onSubmit","event","Submit","class","type","formnovalidate","style","padding","fontSize","fontWeight","button","loading","animationDuration","backgroundColor","back","preventDefault","form","root","querySelector","inputs","querySelectorAll","highestPosition","Number","MAX_VALUE","valid","i","length","input","closest","Validate","_a","sent","IsValid","inputTop","getBoundingClientRect","top","document","body","stringArray","Array","elements","element","nodeName","name","checked","push","concat","encodeURIComponent","value","toString","formData","FormData","append","join","headers","Headers","fetch","credentials","then","response","ok","status","email","subscription","track","window","location","href","destination","catch","error","message","console","log","navigator","onLine","isInteger","ShowPrompt","documentElement","scroll","behavior","data","subscriber","place","DataLayer","subscribe","prompt","setAttribute","Show"],"sources":["src/components/order/shipping/orderForm.tsx"],"sourcesContent":["import { Component, h, Prop, State, Element } from '@stencil/core';\n\nimport { SubscriptionData } from \"../../../global/data/commonDynamic\";\nimport { DataLayer } from '../../../global/dataLayer';\n\n@Component({\n      tag: 'ks-order-form'\n})\nexport class OrderForm {\n\n    @Prop() action: string;\n    @Prop() method: string;\n    @Prop() destination: string;\n    @Prop() button: string;\n    @Prop() back: string;\n\n    @Element() root: HTMLElement;\n\n    @State() loading: boolean = false;\n\n\trender() {\n\n\t\treturn(\n            <form action={this.action} method={this.method} enctype=\"application/x-www-form-urlencoded\" onSubmit={(event)=>this.Submit(event)}>\n                <slot/>\n\n                <div class=\"uk-position-relative uk-margin-medium-top\">\n                    <button type=\"submit\" formnovalidate\n                        class=\"uk-button uk-button-danger uk-width-1-1 ks-text-decorated\"\n                        style={{padding: \"20px\", fontSize: \"28px\", fontWeight: \"700\"}}>\n\n                        <span>{this.button}</span>\n\n                    </button>\n\n                    {this.loading ?\n                        <div class=\"uk-overlay uk-light uk-padding-remove uk-position-cover uk-animation-fade\"\n                            style={{animationDuration: \"0.3s\", backgroundColor: \"#e21334\"}}>\n                            <div uk-spinner=\"ratio: 1.5\" class=\"uk-position-center\"></div>\n                        </div>\n                    : null}\n                </div>\n\n                <ks-order-form-modal back={this.back}></ks-order-form-modal>\n            </form>\n\t\t);\n    }\n\n    async Submit(event: Event) {\n        event.preventDefault();\n\n        const form = this.root.querySelector(\"form\");\n        const inputs = form.querySelectorAll(\"ks-input-dynamic, ks-input-select-dynamic, ks-input-select, ks-input-text, ks-input-check\");\n\n        let highestPosition = Number.MAX_VALUE;\n\n        let valid = true;\n        for (let i = 0; i < inputs.length; i++) {\n            const input = inputs[i] as any;\n            \n            if(input.closest(\"ks-input-dynamic *\") != null) continue;\n\n            if(input.closest(\"ks-order-check-section:not([active])\") != null) continue;\n            if(input.closest(\"ks-order-enable-section:not([active])\") != null) continue;\n            if(input.closest(\"*[hidden]\") != null) continue;\n\n            await input.Validate();\n            if(!await input.IsValid()) {\n                const inputTop = (input as HTMLElement).getBoundingClientRect().top\n                    - document.body.getBoundingClientRect().top;\n\n                if(inputTop < highestPosition)\n                    highestPosition = inputTop;\n\n                valid = false;\n            }\n        }\n\n        if(valid) {\n            const stringArray = new Array<string>();\n            \n            for (let i = 0; i < form.elements.length; i++) {\n                const element = form.elements[i] as HTMLInputElement;\n\n                if( element.nodeName === \"INPUT\" &&\n                    element.type != \"submit\" &&\n                    element.name != \"\"\n                ){\n                    if((element.type == \"checkbox\" || element.type == \"radio\") && !element.checked)\n                        continue;\n\n                    stringArray.push(`${element.name}=${encodeURIComponent(element.value.toString())}`);\n                }\n\n                else if(element.nodeName === \"SELECT\" && element.name != \"\") {\n                    stringArray.push(`${element.name}=${encodeURIComponent(element.value.toString())}`);\n                }\n            }\n\n            const formData = new FormData();\n            formData.append(\"data\", stringArray.join(\"&\") );\n\n            this.loading = true;\n\n            var headers = new Headers();\n            headers.append('pragma', 'no-cache');\n            headers.append('cache-control', 'no-cache');\n\n            await fetch(this.action, {\n                body: formData,\n                method: 'POST',\n                headers: headers,\n                credentials: \"same-origin\"\n            })\n            .then(response => {\n                if(!response.ok)\n                    throw response.status;\n                else {\n                    const email = form.querySelector('input[type=email]') as HTMLInputElement;\n                    const subscription = form.querySelector('input[name=biuletyn]') as HTMLInputElement;\n\n                    this.track(email?.value, subscription?.checked);\n                    window.location.href = this.destination;\n                }\n            })\n            .catch(error => {\n                let message = error;\n\n                console.log(error);\n\n                if(!navigator.onLine)\n                    message = \"Brak połączenia z internetem.\";\n\n                else if(Number.isInteger(error))\n                    message = `Błąd połączenia - ${error}`;\n\n                this.ShowPrompt(message);\n            });\n\n            this.loading = false;\n        }\n\n        else {\n            if('scrollBehavior' in document.documentElement.style)\n                window.scroll({top: highestPosition -100, behavior: \"smooth\"});\n            else window.scroll(0, highestPosition -100);\n        }\n    }\n\n    track(email = \"\", subscription = false) {\n        if(!email || !subscription) return;\n\n        const data: SubscriptionData = {\n            email: email,\n            subscriber: true,\n            place: \"Zapis do newslettera | Rejestracja Zamówienie\"\n        }\n\n        DataLayer.subscribe(data);\n    }\n\n    ShowPrompt(message: string) {\n        const prompt = this.root.querySelector(\"ks-order-form-modal\") as any;\n        prompt.setAttribute(\"message\", message);\n        prompt.Show();\n    }\n}\n"],"mappings":"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"}
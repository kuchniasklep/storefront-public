import{c as n}from"./cart-C-9zqEUA.js";import{j as a,f as t}from"./fetch-Cj4w559p.js";import{D as i}from"./dataLayer-BtunD6i_.js";async function s(a){const t=n.get("products")?.[a];if(t)i.removeFromCart(t);const s=await b(n.get("api").productRemove,{id:a});if(s){if(s.products.length==0)document.location.reload();else B("Błąd usuwania produktu",s,(async n=>{h(n)}))}const o=document.querySelector(`ks-cart-product[ikey="${a}"]`);if(o)o.ResetLoading()}var o=new AbortController;async function c(a,t){let i=null;o.abort();o=new AbortController;const s=await b(n.get("api").productCount,{id:a,ilosc:t.toString()},o.signal);if(s){B("Błąd ilości produktu",s,(async n=>{if("error"in n){D().show("Błąd ilości produktu",n.error.message);i=n?.error?.maxCount??null}else h(n);if("discount"in n==false)p()}))}return i}async function e(a){n.set("loadingDeals",true);const t=await b(n.get("api").addDeal,{id:a});n.set("loadingDeals",false);if(!t||"error"in t){D().show("Błąd dodawania gratisu",t.error.message);return}else await h(t)}async function r(a){g(`ks-cart-select-shipping`);g(`ks-cart-select-payment`);h(await b(n.get("api").countryChange,{data:a}));j(`ks-cart-select-shipping`);j(`ks-cart-select-payment`)}async function u(a){g(`ks-cart-select-payment`);h(await b(n.get("api").shippingChange,{data:a.toString()}));j(`ks-cart-select-payment`)}async function d(a){h(await b(n.get("api").paymentChange,{data:a.toString()}))}async function f(){h(await b(n.get("api").discountRemove));p()}function p(){n.set("discount",{})}async function l(a){const t=await b(n.get("api").discountCode,{data:a});B("Błąd dodawania kodu",t,(n=>{h(n)}));j(`ks-cart-discount-code`)}async function y(a){const t=await b(n.get("api").discountPoints,{data:a.toString()});m("ks-cart-discount-container ks-cart-heading");h(t);j(`ks-cart-discount-points`)}function m(n){const a=document.querySelectorAll(n);let t=0;if(a.length==2)t=a[1].getBoundingClientRect().top-a[0].getBoundingClientRect().top;if(t)window.scrollBy(0,-t)}async function w(t){const i=n.get("api").easyprotectChange;A();await a(i,t).then((n=>n.json())).then((n=>h(n)));C()}async function k(a){const i=n.get("api").easyprotectRemove;A();await t(i,{id:a}).then((n=>n.json())).then((n=>h(n)));C()}function g(n){const a=document.querySelector(n);if(a&&"StartLoading"in a)a.StartLoading()}function j(n){const a=document.querySelector(n);if(a&&"ResetLoading"in a)a.ResetLoading()}async function B(n,a,t){if("message"in a){D().show(n,a.message);delete a.message;setTimeout((()=>{t(a)}),200)}else t(a)}async function b(n,a,i){A();return t(n,a,i).then((n=>n.json())).then((n=>{C();return n})).catch((n=>{C();if(n.name!="AbortError"){L().show(n)}return{}}))}function h(a){Object.keys(a).map((t=>{n.set(t,a[t])}));if("discount"in a==false)p()}function A(){n.set("loading",n.get("loading")+1)}function C(){if(n.get("loading")>0)n.set("loading",n.get("loading")-1)}function D(){return document.querySelector("ks-message-popup")}function L(){return document.querySelector("ks-error-popup")}export{e as a,k as b,y as c,l as d,w as e,f,r as g,d as h,c as p,s as r,u as s,h as u};
//# sourceMappingURL=cart-CoCzShnl.js.map
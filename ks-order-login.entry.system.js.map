{"version":3,"file":"ks-order-login.entry.system.js","sources":["src/components/order/shipping/orderLogin.tsx"],"sourcesContent":["import { Component, h, Element, Prop } from '@stencil/core';\n\n@Component({\n  tag: 'ks-order-login',\n})\nexport class OrderLogin {\n\n    @Element() root: HTMLElement;\n\n    @Prop() api: string = \"\";\n    @Prop() action: string = \"\";\n    @Prop() passwordMessage: string = \"\";\n    @Prop() passwordRecovery: string = \"\";\n\n    @Prop() heading: string = \"\";\n    @Prop() login: string = \"\";\n    @Prop() passwordRecoveryString: string = \"\";\n    @Prop() cartProductsMessage: string = \"\";\n\n    @Prop() promptHeading: string = \"\";\n    @Prop() promptToCart: string = \"\";\n    @Prop() promptToConfirmation: string = \"\";\n\n    componentDidLoad(){\n        this.root.style.display = \"block\";\n    }\n\n    render() {\n        return[\n            <div class=\"uk-padding\" style={{backgroundColor: \"#f2f2f5\"}}>\n                <div class=\"uk-text-center\" style={{maxWidth: \"500px\", margin: \"auto\"}}>\n                    <p class=\"ks-text-decorated uk-text-bold\" style={{fontSize: \"28px\"}}>{this.heading}</p>\n\n                    <form onSubmit={(event)=>this.Submit(event)}>\n                        <slot />\n\n                        <ks-button submit name={this.login} />\n                    </form>\n\n                    <a href={this.passwordRecovery} style={{marginTop: \"10px\", display: \"block\"}}>{this.passwordRecoveryString}</a>\n                </div>\n            </div>\n        ];\n    }\n\n    async Submit(event: Event) {\n        event.preventDefault();\n\n        const form = this.root.querySelector(\"form\");\n        const email = form.querySelector(\"ks-input-dynamic, ks-input-text[email]\") as HTMLKsInputDynamicElement;\n        const pass = form.querySelector(\"ks-input-text[password]\") as HTMLKsInputTextElement;\n\n        await email.Validate();\n        await pass.Validate();\n\n        if (await email.IsValid() && await pass.IsValid()) {\n            var headers = new Headers();\n            headers.append('pragma', 'no-cache');\n            headers.append('cache-control', 'no-cache');\n\n            const formData = new FormData(form);\n\n            const response = await fetch(this.api, {\n                body: formData,\n                method: 'POST',\n                headers: headers,\n                credentials: \"same-origin\"\n            }).then(response => response.text());\n\n            if(response == \"false\")\n                pass.message = this.passwordMessage;\n\n            else if(response == \"true\") {\n                this.LoginPrompt(formData);\n            }\n        }\n    }\n\n    async LoginPrompt(data: FormData) {\n        \n        var headers = new Headers();\n        headers.append('pragma', 'no-cache');\n        headers.append('cache-control', 'no-cache');\n\n        const formData = new FormData();\n        formData.set(\"data\", `email=${encodeURIComponent(data.get(\"email\").toString())}&haslo=${encodeURIComponent(data.get(\"haslo\").toString())}`)\n\n        const response = await fetch(this.action, {\n            body: formData,\n            method: 'POST',\n            headers: headers,\n            credentials: \"same-origin\"\n        }).then(response => response.text());\n\n        const prompt = document.createElement(\"ks-order-login-prompt\");\n        prompt.setAttribute(\"heading\", this.promptHeading);\n        prompt.setAttribute(\"to-cart\", this.promptToCart);\n        prompt.setAttribute(\"to-confirmation\", this.promptToConfirmation);\n    \n        if(response.search(\"koszyk.html\") != -1) {\n            prompt.setAttribute(\"message\", this.cartProductsMessage);\n        }\n        \n        document.body.appendChild(prompt);\n    }\n}"],"names":[],"mappings":"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"}
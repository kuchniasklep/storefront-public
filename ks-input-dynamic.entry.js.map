{"version":3,"names":["InputDynamic","componentDidLoad","input","this","root","querySelector","component","setAttribute","onchange","Validate","async","strings","common","get","headers","Headers","append","ready","Promise","resolve","IsValid","loading","fetch","api","value","method","credentials","then","response","ok","status","text","data","message","catch","error","Number","isInteger","inputConnectionError","navigator","onLine","inputInternetConnectionError","render","h","class","style","top","right","animationDuration","animationDelay"],"sources":["src/components/input/inputDynamic.tsx"],"sourcesContent":["import { Component, h, Prop, Element, Method, State } from '@stencil/core';\nimport { common } from '../../global/data/common';\n\n\n@Component({\n      tag: 'ks-input-dynamic'\n})\nexport class InputDynamic {\n    @Element() root: HTMLElement;\n\n    @Prop() api: string = \"\";\n    @Prop() message: string = \"\";\n\n    ready: Promise<boolean>;\n\n    componentDidLoad() { \n        const input = this.root.querySelector(\"input\") as HTMLInputElement;\n        const component = this.root.querySelector(\"ks-input-text\") as HTMLKsInputTextElement;\n        component.setAttribute(\"novalidate\", \"novalidate\");\n\n        input.onchange = ()=>this.Validate();\n    }\n\n    @Method()\n    async Validate() {\n        const strings = common.get(\"translations\");\n\n        const input = this.root.querySelector(\"input\") as HTMLInputElement;\n        const component = this.root.querySelector(\"ks-input-text\") as HTMLKsInputTextElement;\n\n        var headers = new Headers();\n        headers.append('pragma', 'no-cache');\n        headers.append('cache-control', 'no-cache');\n\n        this.ready = new Promise<boolean>(async (resolve)=>{\n            await component.Validate()\n            if(await component.IsValid()) {\n                this.loading = true;\n\n                await fetch(this.api + input.value, {\n                    method: 'GET', \n                    headers: headers,\n                    credentials: \"same-origin\"\n                })\n                    .then(response => {\n                        if(!response.ok)\n                            throw response.status;\n\n                        return response.text();\n                    })\n                    .then(data => {\n                        if (data == \"false\")\n                            throw this.message;\n\n                        else if (data != \"true\")\n                            throw data;\n\n                        else resolve(true);\n                    })\n                    .catch(error => {\n                        let message = error;\n\n                        if(Number.isInteger(error))\n                            message = strings.inputConnectionError + error;\n\n                        else if(!navigator.onLine)\n                            message = strings.inputInternetConnectionError;\n                        \n                        component.setAttribute(\"message\", message);\n                        resolve(false);\n                    });\n            }\n            else resolve(false);\n\n            this.loading = false;\n        });\n    }\n\n    @Method()\n    async IsValid() {\n        return await this.ready;\n    }\n\n    @State() loading: boolean = false;\n\n\trender() {\n\t\treturn (\n            <div class=\"uk-position-relative\">\n                <slot />\n\n                {this.loading ?\n                    <div class=\"uk-position-absolute uk-animation-fade\"\n                         style={{top: \"7px\", right: \"7px\", animationDuration: \"0.3s\", animationDelay: \"0.5s\"}}\n                         uk-spinner=\"ratio: 0.9\">\n                    </div>\n                : null}\n            </div>\n        );\n    }\n}\n"],"mappings":"iIAOaA,EAAY,M,kCAGC,G,aACI,G,aAwEE,K,CApE5BC,mBACI,MAAMC,EAAQC,KAAKC,KAAKC,cAAc,SACtC,MAAMC,EAAYH,KAAKC,KAAKC,cAAc,iBAC1CC,EAAUC,aAAa,aAAc,cAErCL,EAAMM,SAAW,IAAIL,KAAKM,U,CAI9BC,iBACI,MAAMC,EAAUC,EAAOC,IAAI,gBAE3B,MAAMX,EAAQC,KAAKC,KAAKC,cAAc,SACtC,MAAMC,EAAYH,KAAKC,KAAKC,cAAc,iBAE1C,IAAIS,EAAU,IAAIC,QAClBD,EAAQE,OAAO,SAAU,YACzBF,EAAQE,OAAO,gBAAiB,YAEhCb,KAAKc,MAAQ,IAAIC,SAAiBR,MAAOS,UAC/Bb,EAAUG,WAChB,SAASH,EAAUc,UAAW,CAC1BjB,KAAKkB,QAAU,WAETC,MAAMnB,KAAKoB,IAAMrB,EAAMsB,MAAO,CAChCC,OAAQ,MACRX,QAASA,EACTY,YAAa,gBAEZC,MAAKC,IACF,IAAIA,EAASC,GACT,MAAMD,EAASE,OAEnB,OAAOF,EAASG,MAAM,IAEzBJ,MAAKK,IACF,GAAIA,GAAQ,QACR,MAAM7B,KAAK8B,aAEV,GAAID,GAAQ,OACb,MAAMA,OAELb,EAAQ,KAAK,IAErBe,OAAMC,IACH,IAAIF,EAAUE,EAEd,GAAGC,OAAOC,UAAUF,GAChBF,EAAUtB,EAAQ2B,qBAAuBH,OAExC,IAAII,UAAUC,OACfP,EAAUtB,EAAQ8B,6BAEtBnC,EAAUC,aAAa,UAAW0B,GAClCd,EAAQ,MAAM,G,MAGrBA,EAAQ,OAEbhB,KAAKkB,QAAU,KAAK,G,CAK5BX,gBACI,aAAaP,KAAKc,K,CAKzByB,SACC,OACUC,EAAA,OAAKC,MAAM,wBACPD,EAAA,aAECxC,KAAKkB,QACFsB,EAAA,OAAKC,MAAM,yCACNC,MAAO,CAACC,IAAK,MAAOC,MAAO,MAAOC,kBAAmB,OAAQC,eAAgB,QAAO,aACzE,eAElB,K"}
import{c as n}from"./cart-aff8d68d.js";import{f as a,j as t}from"./fetch-bbb23998.js";async function c(a){const t=await B((async()=>j(n.get("api").productRemove,{id:a})));t&&(0==t.products.length?document.location.reload():b("Błąd usuwania produktu",t,(async n=>{P(n),"discount"in n==0&&this.RemoveDiscount()})));const c=document.querySelector(`ks-cart-product[ikey="${a}"]`);c&&c.ResetLoading()}var i={};async function s(n,a,t){i[n]?i[n]=()=>o(n,a,t):(i[n]=()=>{},o(n,a,t).then((()=>{i[n]&&(i[n](),i[n]=void 0)})))}async function o(a,t,c){const i=await B((async()=>j(n.get("api").productCount,{id:a,ilosc:t.toString()})));i?b("Błąd ilości produktu",i,(async t=>{"error"in t?(D().show("Błąd ilości produktu",t.error.message),n.set("products",d(a,t.error.amount,t.error.maxAmount))):await P(t),"discount"in t==0&&l()})):(n.set("products",d(a,c)),this.SetAmount(c,`ks-cart-product[ikey="${a}"] ks-cart-spinner`))}function d(a,t,c){const i=n.get("products");return i[a].quantity=t,c&&(i[a].maxQuantity=c),i}async function u(a){n.set("loadingDeals",!0);const t=await j(n.get("api").addDeal,{id:a});if(n.set("loadingDeals",!1),t&&!("error"in t)){await P(t);for(const a in n.get("products")){const t=n.get("products")[a],c=document.querySelector(`ks-cart-product[product-id="${t.id}"] ks-cart-spinner`);null==c||c.SetAmount(t.quantity)}}else D().show("Błąd dodawania gratisu",t.error.message)}async function r(a){w("ks-cart-select-shipping"),w("ks-cart-select-payment"),P(await j(n.get("api").countryChange,{data:a})),h("ks-cart-select-shipping"),h("ks-cart-select-payment")}async function e(a){w("ks-cart-select-payment"),P(await j(n.get("api").shippingChange,{data:a.toString()})),h("ks-cart-select-payment")}async function p(a){P(await j(n.get("api").paymentChange,{data:a.toString()}))}async function f(){P(await j(n.get("api").discountRemove)),l()}function l(){n.set("discount",{})}async function y(a){b("Błąd dodawania kodu",await j(n.get("api").discountCode,{data:a}),(n=>{P(n)})),h("ks-cart-discount-code")}async function k(a){const t=await j(n.get("api").discountPoints,{data:a.toString()});!function(){const n=document.querySelectorAll("ks-cart-discount-container ks-cart-heading");let a=0;2==n.length&&(a=n[1].getBoundingClientRect().top-n[0].getBoundingClientRect().top),a&&window.scrollBy(0,-a)}(),P(t),h("ks-cart-discount-points")}async function g(a){const c=n.get("api").easyprotectChange;$(),await t(c,a).then((n=>n.json())).then((n=>P(n))),v()}async function m(t){const c=n.get("api").easyprotectRemove;$(),await a(c,{id:t}).then((n=>n.json())).then((n=>P(n))),v()}function w(n){const a=document.querySelector(n);a&&"StartLoading"in a&&a.StartLoading()}function h(n){const a=document.querySelector(n);a&&"ResetLoading"in a&&a.ResetLoading()}async function b(n,a,t){"message"in a?(D().show(n,a.message),delete a.message,setTimeout((()=>{t(a)}),200)):t(a)}async function B(a){n.set("loadingProducts",n.get("loadingProducts")+1);const t=await a();return n.set("loadingProducts",n.get("loadingProducts")-1),t}async function j(n,t){return $(),a(n,t).then((n=>n.json())).then((n=>(v(),n))).catch((n=>(v(),document.querySelector("ks-error-popup").show(n),{})))}function P(a){Object.keys(a).map((t=>{n.set(t,a[t])}))}function $(){n.set("loading",n.get("loading")+1)}function v(){n.set("loading",n.get("loading")-1)}function D(){return document.querySelector("ks-message-popup")}export{u as a,p as b,r as c,f as d,y as e,k as f,g,m as h,s as p,c as r,e as s,P as u}
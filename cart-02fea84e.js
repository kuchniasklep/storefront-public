import{c as a}from"./cart-3ea22f3a.js";import{f as n,j as t}from"./fetch-1f8a9006.js";import{D as i}from"./dataLayer-19403a84.js";async function o(n){const t=a.get("products")?.[n];t&&i.removeFromCart(t);const o=await h(a.get("api").productRemove,{id:n});o&&(0==o.products.length?document.location.reload():b("Błąd usuwania produktu",o,(async a=>{j(a)})));const c=document.querySelector(`ks-cart-product[ikey="${n}"]`);c&&c.ResetLoading()}var c=new AbortController;async function s(n,t){let i=null;c.abort(),c=new AbortController;const o=await h(a.get("api").productCount,{id:n,ilosc:t.toString()},c.signal);return o&&b("Błąd ilości produktu",o,(async a=>{"error"in a?(D().show("Błąd ilości produktu",a.error.message),i=a?.error?.maxCount??null):j(a),"discount"in a==0&&f()})),i}async function e(n){a.set("loadingDeals",!0);const t=await h(a.get("api").addDeal,{id:n});a.set("loadingDeals",!1),t&&!("error"in t)?await j(t):D().show("Błąd dodawania gratisu",t.error.message)}async function r(n){k("ks-cart-select-shipping"),k("ks-cart-select-payment"),j(await h(a.get("api").countryChange,{data:n})),g("ks-cart-select-shipping"),g("ks-cart-select-payment")}async function u(n){k("ks-cart-select-payment"),j(await h(a.get("api").shippingChange,{data:n.toString()})),g("ks-cart-select-payment")}async function d(n){j(await h(a.get("api").paymentChange,{data:n.toString()}))}async function p(){j(await h(a.get("api").discountRemove)),f()}function f(){a.set("discount",{})}async function l(n){b("Błąd dodawania kodu",await h(a.get("api").discountCode,{data:n}),(a=>{j(a)})),g("ks-cart-discount-code")}async function y(n){const t=await h(a.get("api").discountPoints,{data:n.toString()});!function(){const a=document.querySelectorAll("ks-cart-discount-container ks-cart-heading");let n=0;2==a.length&&(n=a[1].getBoundingClientRect().top-a[0].getBoundingClientRect().top),n&&window.scrollBy(0,-n)}(),j(t),g("ks-cart-discount-points")}async function m(n){const i=a.get("api").easyprotectChange;B(),await t(i,n).then((a=>a.json())).then((a=>j(a))),A()}async function w(t){const i=a.get("api").easyprotectRemove;B(),await n(i,{id:t}).then((a=>a.json())).then((a=>j(a))),A()}function k(a){const n=document.querySelector(a);n&&"StartLoading"in n&&n.StartLoading()}function g(a){const n=document.querySelector(a);n&&"ResetLoading"in n&&n.ResetLoading()}async function b(a,n,t){"message"in n?(D().show(a,n.message),delete n.message,setTimeout((()=>{t(n)}),200)):t(n)}async function h(a,t,i){return B(),n(a,t,i).then((a=>a.json())).then((a=>(A(),a))).catch((a=>(A(),"AbortError"!=a.name&&document.querySelector("ks-error-popup").show(a),{})))}function j(n){Object.keys(n).map((t=>{a.set(t,n[t])})),"discount"in n==0&&f()}function B(){a.set("loading",a.get("loading")+1)}function A(){a.get("loading")>0&&a.set("loading",a.get("loading")-1)}function D(){return document.querySelector("ks-message-popup")}export{e as a,y as b,r as c,l as d,m as e,p as f,w as g,s as h,d as p,o as r,u as s,j as u}
import{c as n}from"./cart-c75b6837.js";import{f as a,j as t}from"./fetch-5aca2b8c.js";async function c(a){const t=await b((async()=>j(n.get("api").productRemove,{id:a})));t&&(0==t.products.length?document.location.reload():B("Błąd usuwania produktu",t,(async n=>{v(n),"discount"in n==0&&this.RemoveDiscount()})));const c=document.querySelector(`ks-cart-product[ikey="${a}"]`);c&&c.ResetLoading()}var i={};async function s(n,a,t){i[n]?i[n]=()=>o(n,a,t):(i[n]=()=>{},o(n,a,t).then((()=>{i[n]&&(i[n](),i[n]=void 0)})))}async function o(a,t,c){const i=await b((async()=>j(n.get("api").productCount,{id:a,ilosc:t.toString()})));i?B("Błąd ilości produktu",i,(async t=>{"error"in t?(D().show("Błąd ilości produktu",t.error.message),n.set("products",d(a,t.error.amount,t.error.maxAmount))):await v(t),"discount"in t==0&&l()})):(n.set("products",d(a,c)),this.SetAmount(c,`ks-cart-product[ikey="${a}"] ks-cart-spinner`))}function d(a,t,c){const i=n.get("products");return i[a].amount=t,c&&(i[a].maxAmount=c),i}async function u(a){var t;n.set("loadingDeals",!0);const c=await j(n.get("api").addDeal,{id:a});if(n.set("loadingDeals",!1),c&&!("error"in c)){await v(c);for(const a in n.get("products")){const c=n.get("products")[a];null===(t=document.querySelector(`ks-cart-product[product-id="${c.id}"] ks-cart-spinner`))||void 0===t||t.SetAmount(c.amount)}}else D().show("Błąd dodawania gratisu",c.error.message)}async function r(a){m("ks-cart-select-shipping"),m("ks-cart-select-payment"),v(await j(n.get("api").countryChange,{data:a})),h("ks-cart-select-shipping"),h("ks-cart-select-payment")}async function e(a){m("ks-cart-select-payment"),v(await j(n.get("api").shippingChange,{data:a.toString()})),h("ks-cart-select-payment")}async function p(a){v(await j(n.get("api").paymentChange,{data:a.toString()}))}async function f(){v(await j(n.get("api").discountRemove)),l()}function l(){n.set("discount",{})}async function y(a){B("Błąd dodawania kodu",await j(n.get("api").discountCode,{data:a}),(n=>{v(n)})),h("ks-cart-discount-code")}async function k(a){const t=await j(n.get("api").discountPoints,{data:a.toString()});!function(){const n=document.querySelectorAll("ks-cart-discount-container ks-cart-heading");let a=0;2==n.length&&(a=n[1].getBoundingClientRect().top-n[0].getBoundingClientRect().top),a&&window.scrollBy(0,-a)}(),v(t),h("ks-cart-discount-points")}async function g(a){const c=n.get("api").easyprotectChange;P(),await t(c,a).then((n=>n.json())).then((n=>v(n))),$()}async function w(t){const c=n.get("api").easyprotectRemove;P(),await a(c,{id:t}).then((n=>n.json())).then((n=>v(n))),$()}function m(n){const a=document.querySelector(n);a&&"StartLoading"in a&&a.StartLoading()}function h(n){const a=document.querySelector(n);a&&"ResetLoading"in a&&a.ResetLoading()}async function B(n,a,t){"message"in a?(D().show(n,a.message),delete a.message,setTimeout((()=>{t(a)}),200)):t(a)}async function b(a){n.set("loadingProducts",n.get("loadingProducts")+1);const t=await a();return n.set("loadingProducts",n.get("loadingProducts")-1),t}async function j(n,t){return P(),a(n,t).then((n=>n.json())).then((n=>($(),n))).catch((n=>($(),this.errorPopup.show(n),{})))}function v(a){Object.keys(a).map((t=>{n.set(t,a[t])}))}function P(){n.set("loading",n.get("loading")+1)}function $(){n.set("loading",n.get("loading")-1)}function D(){return document.querySelector("ks-message-popup")}export{u as a,p as b,r as c,f as d,y as e,k as f,g,w as h,s as p,c as r,e as s,v as u}
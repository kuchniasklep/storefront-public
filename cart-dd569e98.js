import{c as n}from"./cart-c69e9ac3.js";import{f as t,j as a}from"./fetch-13200e62.js";async function i(t){const a=await P((async()=>v(n.get("api").productRemove,{id:t})));if(a){if(a.products.length==0)document.location.reload();else j("Błąd usuwania produktu",a,(async n=>{$(n);if("discount"in n==false)this.RemoveDiscount()}))}const i=document.querySelector(`ks-cart-product[ikey="${t}"]`);if(i)i.ResetLoading()}var c={};async function s(n,t,a){if(c[n]){c[n]=()=>o(n,t,a)}else{c[n]=()=>{};o(n,t,a).then((()=>{if(c[n]){c[n]();c[n]=undefined}}))}}async function o(t,a,i){const c=await P((async()=>v(n.get("api").productCount,{id:t,ilosc:a.toString()})));if(c){j("Błąd ilości produktu",c,(async a=>{if("error"in a){L().show("Błąd ilości produktu",a.error.message);n.set("products",e(t,a.error.amount,a.error.maxAmount))}else await $(a);if("discount"in a==false)l()}))}else{n.set("products",e(t,i));this.SetAmount(i,`ks-cart-product[ikey="${t}"] ks-cart-spinner`)}}function e(t,a,i){const c=n.get("products");c[t].quantity=a;if(i)c[t].maxQuantity=i;return c}async function u(t){n.set("loadingDeals",true);const a=await v(n.get("api").addDeal,{id:t});n.set("loadingDeals",false);if(!a||"error"in a){L().show("Błąd dodawania gratisu",a.error.message);return}else await $(a);for(const t in n.get("products")){const a=n.get("products")[t];const i=document.querySelector(`ks-cart-product[product-id="${a.id}"] ks-cart-spinner`);i===null||i===void 0?void 0:i.SetAmount(a.quantity)}}async function d(t){h(`ks-cart-select-shipping`);h(`ks-cart-select-payment`);$(await v(n.get("api").countryChange,{data:t}));B(`ks-cart-select-shipping`);B(`ks-cart-select-payment`)}async function r(t){h(`ks-cart-select-payment`);$(await v(n.get("api").shippingChange,{data:t.toString()}));B(`ks-cart-select-payment`)}async function f(t){$(await v(n.get("api").paymentChange,{data:t.toString()}))}async function p(){$(await v(n.get("api").discountRemove));l()}function l(){n.set("discount",{})}async function y(t){const a=await v(n.get("api").discountCode,{data:t});j("Błąd dodawania kodu",a,(n=>{$(n)}));B(`ks-cart-discount-code`)}async function k(t){const a=await v(n.get("api").discountPoints,{data:t.toString()});g("ks-cart-discount-container ks-cart-heading");$(a);B(`ks-cart-discount-points`)}function g(n){const t=document.querySelectorAll(n);let a=0;if(t.length==2)a=t[1].getBoundingClientRect().top-t[0].getBoundingClientRect().top;if(a)window.scrollBy(0,-a)}async function m(t){const i=n.get("api").easyprotectChange;b();await a(i,t).then((n=>n.json())).then((n=>$(n)));D()}async function w(a){const i=n.get("api").easyprotectRemove;b();await t(i,{id:a}).then((n=>n.json())).then((n=>$(n)));D()}function h(n){const t=document.querySelector(n);if(t&&"StartLoading"in t)t.StartLoading()}function B(n){const t=document.querySelector(n);if(t&&"ResetLoading"in t)t.ResetLoading()}async function j(n,t,a){if("message"in t){L().show(n,t.message);delete t.message;setTimeout((()=>{a(t)}),200)}else a(t)}async function P(t){n.set("loadingProducts",n.get("loadingProducts")+1);const a=await t();n.set("loadingProducts",n.get("loadingProducts")-1);return a}async function v(n,a){b();return t(n,a).then((n=>n.json())).then((n=>{D();return n})).catch((n=>{D();x().show(n);return{}}))}function $(t){Object.keys(t).map((a=>{n.set(a,t[a])}))}function b(){n.set("loading",n.get("loading")+1)}function D(){n.set("loading",n.get("loading")-1)}function L(){return document.querySelector("ks-message-popup")}function x(){return document.querySelector("ks-error-popup")}export{u as a,f as b,d as c,p as d,y as e,k as f,m as g,w as h,s as p,i as r,r as s,$ as u};
//# sourceMappingURL=cart-dd569e98.js.map
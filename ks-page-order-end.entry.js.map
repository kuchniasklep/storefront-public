{"version":3,"names":["orderSuccess","createStore","eventId","heading","message","homepage","orderEndCss","PageOrderEnd","constructor","hostRef","this","displayPayment","paymentOpacity","componentWillLoad","orderDataElement","document","getElementById","orderData","JSON","parse","innerHTML","Object","keys","map","key","set","track","verify","get","order","setTimeout","Fetch","then","response","text","location","reload","catch","render","h","skipbase","commonData","commonDynamicData","class","dark","style","display","opacity","round","link","name"],"sources":["src/global/data/orderEnd.ts","src/components/pages/order/orderEnd.css?tag=ks-page-order-end","src/components/pages/order/orderEnd.tsx"],"sourcesContent":["import { createStore } from \"@stencil/store\";\nimport { OrderData, OrderDetailsData } from \"./order\";\n\nexport const orderSuccess = createStore({\n    eventId: \"\",\n\n    heading: \"\",\n    message: \"\",\n    homepage: \"\",\n\n} as OrderSuccessData);\n\nexport interface OrderSuccessData {\n    eventId: string;\n\n    heading: string;\n    message: string;\n    homepage: string;\n\n    verify: string;\n    error: boolean;\n    errorHeading: string;\n    errorMessage: string;\n\n    orderId: string;\n    orderString: string;\n    orderLink: string;\n    \n    order: OrderData;\n    details: OrderDetailsData;\n}","ks-page-order-end .card {\n    display: block;\n    padding: 0px;\n    box-sizing: border-box;\n\n    max-width: 800px;\n    width: 100%;\n    margin: auto;\n    padding: 50px 20px;\n\n    color: var(--card-text-color);\n    text-align: center;\n}\n\nks-page-order-end .card ks-icon {\n    margin-right: 10px;\n}\n\nks-page-order-end .card h1 {\n    font-size: 22px;\n    font-weight: 700;\n}\n\nks-page-order-end .card .payment {\n    margin-top: 20px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-wrap: wrap;\n\n    opacity: 1;\n    transition: opacity ease 0.3s;\n}\n\nks-page-order-end .card .loader {\n    position: relative;\n    height: 40px;\n    margin-top: 20px;\n}\n\nks-page-order-end .card .buttons {\n    margin-top: 10px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex-wrap: wrap;\n}\n\nks-page-order-end .card .buttons ks-button {\n    margin: 5px;\n}\n\n\nks-page-order-end .card h2 {\n    margin: 20px auto 5px auto;\n    font-weight: 700;\n}","import { Component, h, Prop, State } from '@stencil/core';\nimport { orderSuccess, OrderSuccessData } from \"../../../global/data/orderEnd\";\nimport Fetch from '../../../global/functions/fetch';\n\n@Component({\n    tag: 'ks-page-order-end',\n    styleUrl: 'orderEnd.css'\n})\nexport class PageOrderEnd {\n    @Prop() skipbase: boolean;\n    @Prop() commonData: string;\n    @Prop() commonDynamicData: string;\n\n    @Prop() orderData: string;\n    @State() displayPayment: boolean = true;\n    @State() paymentOpacity: boolean = true;\n\n    componentWillLoad() {\n        const orderDataElement = document.getElementById(this.orderData);\n\t\tconst orderData = JSON.parse(orderDataElement.innerHTML) as OrderSuccessData;\n\n        Object.keys(orderData).map(key => {\n\t\t\torderSuccess.set(key as keyof OrderSuccessData, orderData[key]);\n\t\t});\n\n        this.track();\n\n\n        const verify = orderSuccess.get('verify');\n        const order = orderSuccess.get('orderId');\n\n        if(verify) {\n            this.displayPayment = false;\n            this.paymentOpacity = false;\n\n            this.verify(verify, order);\n\n            setTimeout(()=>{\n                this.displayPayment = true;\n            }, 3000);\n\n            setTimeout(()=>{\n                this.paymentOpacity = true;\n            }, 3100);\n        }\n    }\n\n    verify(verify, order) {\n        setTimeout(()=>{\n            Fetch(verify + `&order=${order}`)\n                .then(response => {\n                    response.text()\n                        .then(text=>{\n                            if(text == \"OK\")\n                                document.location.reload();\n                            else this.verify(verify, order);\n                        })\n                        .catch(()=> this.verify(verify, order))\n                })\n                .catch(()=> this.verify(verify, order))\n        }, 2000);\n    }\n\n    track() {\n        /*if(!orderSuccess.get('error'))\n            window.dataLayer?.push({\n                currency: 'PLN',\n                transaction_id: orderSuccess.get('orderID'),\n                value: orderSuccess.get('orderValue'),\n                items: Object.entries(orderSuccess.get('products')).map( ([id, product]) => { return {\n                    item_id: id,\n                    item_name: product.name,\n                    currency: 'PLN',\n                    price: product.price,\n                    quantity: product.amount\n                }}),\n            });\n        */\n    }\n\n\trender() {\n\t\treturn <ks-page-base skipbase={this.skipbase} commonData={this.commonData} commonDynamicData={this.commonDynamicData}>\n            <div class=\"card\">\n                <h1 class=\"heading\">{orderSuccess.get('heading')}</h1>\n\n                <section class=\"content\">\n                    <div class=\"message\">{orderSuccess.get('message')}</div>\n\n                    {orderSuccess.get('error') ? [\n                        <h2>{orderSuccess.get('errorHeading')}</h2>,\n                        <div>{orderSuccess.get('errorMessage')}</div>\n                    ] : null}\n\n                    {orderSuccess.get('verify') ?\n                        <div class=\"loader\">\n                            <ks-loader dark />\n                        </div> \n                    : null}\n\n                    <div class=\"payment\" style={{display: this.displayPayment ? null : \"none\", opacity: this.paymentOpacity ? null : \"0\"}}>\n                        <slot/>\n                    </div>\n\n                    <div class=\"buttons\">\n                        {orderSuccess.get('orderString') ? \n                            <ks-button round link={orderSuccess.get('orderLink')} name={orderSuccess.get('orderString')} />\n                        : null}\n                        \n                        <ks-button round link=\"/\" name={orderSuccess.get('homepage')} />\n                    </div>\n                </section>\n            </div>\n        </ks-page-base>;\n\t}\n}\n"],"mappings":"+HAGO,MAAMA,EAAeC,EAAY,CACpCC,QAAS,GAETC,QAAS,GACTC,QAAS,GACTC,SAAU,KCRd,MAAMC,EAAc,o+B,MCQPC,EAAY,MAJzB,WAAAC,CAAAC,G,UAUaC,KAAcC,eAAY,KAC1BD,KAAcE,eAAY,IAmGtC,CAjGG,iBAAAC,GACI,MAAMC,EAAmBC,SAASC,eAAeN,KAAKO,WAC5D,MAAMA,EAAYC,KAAKC,MAAML,EAAiBM,WAExCC,OAAOC,KAAKL,GAAWM,KAAIC,IAChCxB,EAAayB,IAAID,EAA+BP,EAAUO,GAAK,IAG1Dd,KAAKgB,QAGL,MAAMC,EAAS3B,EAAa4B,IAAI,UAChC,MAAMC,EAAQ7B,EAAa4B,IAAI,WAE/B,GAAGD,EAAQ,CACPjB,KAAKC,eAAiB,MACtBD,KAAKE,eAAiB,MAEtBF,KAAKiB,OAAOA,EAAQE,GAEpBC,YAAW,KACPpB,KAAKC,eAAiB,IAAI,GAC3B,KAEHmB,YAAW,KACPpB,KAAKE,eAAiB,IAAI,GAC3B,K,EAIX,MAAAe,CAAOA,EAAQE,GACXC,YAAW,KACPC,EAAMJ,EAAS,UAAUE,KACpBG,MAAKC,IACFA,EAASC,OACJF,MAAKE,IACF,GAAGA,GAAQ,KACPnB,SAASoB,SAASC,cACjB1B,KAAKiB,OAAOA,EAAQE,EAAM,IAElCQ,OAAM,IAAK3B,KAAKiB,OAAOA,EAAQE,IAAO,IAE9CQ,OAAM,IAAK3B,KAAKiB,OAAOA,EAAQE,IAAO,GAC5C,I,CAGP,KAAAH,G,CAiBH,MAAAY,GACC,OAAOC,EAAA,gBAAAf,IAAA,2CAAcgB,SAAU9B,KAAK8B,SAAUC,WAAY/B,KAAK+B,WAAYC,kBAAmBhC,KAAKgC,mBACzFH,EAAK,OAAAf,IAAA,2CAAAmB,MAAM,QACPJ,EAAI,MAAAf,IAAA,2CAAAmB,MAAM,WAAW3C,EAAa4B,IAAI,YAEtCW,EAAS,WAAAf,IAAA,2CAAAmB,MAAM,WACXJ,EAAK,OAAAf,IAAA,2CAAAmB,MAAM,WAAW3C,EAAa4B,IAAI,YAEtC5B,EAAa4B,IAAI,SAAW,CACzBW,EAAA,UAAKvC,EAAa4B,IAAI,iBACtBW,EAAA,WAAMvC,EAAa4B,IAAI,kBACvB,KAEH5B,EAAa4B,IAAI,UACdW,EAAK,OAAAI,MAAM,UACPJ,EAAW,aAAAK,KAAI,QAErB,KAEFL,EAAA,OAAAf,IAAA,2CAAKmB,MAAM,UAAUE,MAAO,CAACC,QAASpC,KAAKC,eAAiB,KAAO,OAAQoC,QAASrC,KAAKE,eAAiB,KAAO,MAC7G2B,EAAA,QAAAf,IAAA,8CAGJe,EAAK,OAAAf,IAAA,2CAAAmB,MAAM,WACN3C,EAAa4B,IAAI,eACdW,EAAA,aAAWS,MAAM,KAAAC,KAAMjD,EAAa4B,IAAI,aAAcsB,KAAMlD,EAAa4B,IAAI,iBAC/E,KAEFW,EAAA,aAAAf,IAAA,2CAAWwB,MAAM,KAAAC,KAAK,IAAIC,KAAMlD,EAAa4B,IAAI,iB","ignoreList":[]}
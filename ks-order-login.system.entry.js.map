{"version":3,"names":["OrderLogin","exports","class_1","hostRef","this","api","action","passwordMessage","passwordRecovery","heading","login","passwordRecoveryString","cartProductsMessage","promptHeading","promptToCart","promptToConfirmation","prototype","componentDidLoad","root","style","display","render","_this","h","key","class","backgroundColor","maxWidth","margin","fontSize","onSubmit","event","Submit","submit","name","href","marginTop","preventDefault","form","querySelector","email","pass","Validate","_b","sent","IsValid","headers","Headers","append","formData","FormData","fetch","body","method","credentials","then","response","text","message","LoginPrompt","data","set","concat","encodeURIComponent","get","toString","_a","prompt","document","createElement","setAttribute","search","appendChild"],"sources":["src/components/order/shipping/orderLogin.tsx"],"sourcesContent":["import { Component, h, Element, Prop } from '@stencil/core';\n\n@Component({\n  tag: 'ks-order-login',\n})\nexport class OrderLogin {\n\n    @Element() root: HTMLElement;\n\n    @Prop() api: string = \"\";\n    @Prop() action: string = \"\";\n    @Prop() passwordMessage: string = \"\";\n    @Prop() passwordRecovery: string = \"\";\n\n    @Prop() heading: string = \"\";\n    @Prop() login: string = \"\";\n    @Prop() passwordRecoveryString: string = \"\";\n    @Prop() cartProductsMessage: string = \"\";\n\n    @Prop() promptHeading: string = \"\";\n    @Prop() promptToCart: string = \"\";\n    @Prop() promptToConfirmation: string = \"\";\n\n    componentDidLoad(){\n        this.root.style.display = \"block\";\n    }\n\n    render() {\n        return[\n            <div class=\"uk-padding\" style={{backgroundColor: \"#f2f2f5\"}}>\n                <div class=\"uk-text-center\" style={{maxWidth: \"500px\", margin: \"auto\"}}>\n                    <p class=\"ks-text-decorated uk-text-bold\" style={{fontSize: \"28px\"}}>{this.heading}</p>\n\n                    <form onSubmit={(event)=>this.Submit(event)}>\n                        <slot />\n\n                        <ks-button submit name={this.login} />\n                    </form>\n\n                    <a href={this.passwordRecovery} style={{marginTop: \"10px\"}}>{this.passwordRecoveryString}</a>\n                </div>\n            </div>\n        ];\n    }\n\n    async Submit(event: Event) {\n        event.preventDefault();\n\n        const form = this.root.querySelector(\"form\");\n        const email = form.querySelector(\"ks-input-dynamic, ks-input-text[email]\") as HTMLKsInputDynamicElement;\n        const pass = form.querySelector(\"ks-input-text[password]\") as HTMLKsInputTextElement;\n\n        await email.Validate();\n        await pass.Validate();\n\n        if (await email.IsValid() && await pass.IsValid()) {\n            var headers = new Headers();\n            headers.append('pragma', 'no-cache');\n            headers.append('cache-control', 'no-cache');\n\n            const formData = new FormData(form);\n\n            const response = await fetch(this.api, {\n                body: formData,\n                method: 'POST',\n                headers: headers,\n                credentials: \"same-origin\"\n            }).then(response => response.text());\n\n            if(response == \"false\")\n                pass.message = this.passwordMessage;\n\n            else if(response == \"true\") {\n                this.LoginPrompt(formData);\n            }\n        }\n    }\n\n    async LoginPrompt(data: FormData) {\n        \n        var headers = new Headers();\n        headers.append('pragma', 'no-cache');\n        headers.append('cache-control', 'no-cache');\n\n        const formData = new FormData();\n        formData.set(\"data\", `email=${encodeURIComponent(data.get(\"email\").toString())}&haslo=${encodeURIComponent(data.get(\"haslo\").toString())}`)\n\n        const response = await fetch(this.action, {\n            body: formData,\n            method: 'POST',\n            headers: headers,\n            credentials: \"same-origin\"\n        }).then(response => response.text());\n\n        const prompt = document.createElement(\"ks-order-login-prompt\");\n        prompt.setAttribute(\"heading\", this.promptHeading);\n        prompt.setAttribute(\"to-cart\", this.promptToCart);\n        prompt.setAttribute(\"to-confirmation\", this.promptToConfirmation);\n    \n        if(response.search(\"koszyk.html\") != -1) {\n            prompt.setAttribute(\"message\", this.cartProductsMessage);\n        }\n        \n        document.body.appendChild(prompt);\n    }\n}"],"mappings":"wmDAKaA,EAAUC,EAAA,4BAHvB,SAAAC,EAAAC,G,UAOYC,KAAGC,IAAW,GACdD,KAAME,OAAW,GACjBF,KAAeG,gBAAW,GAC1BH,KAAgBI,iBAAW,GAE3BJ,KAAOK,QAAW,GAClBL,KAAKM,MAAW,GAChBN,KAAsBO,uBAAW,GACjCP,KAAmBQ,oBAAW,GAE9BR,KAAaS,cAAW,GACxBT,KAAYU,aAAW,GACvBV,KAAoBW,qBAAW,EAoF1C,CAlFGb,EAAAc,UAAAC,iBAAA,WACIb,KAAKc,KAAKC,MAAMC,QAAU,O,EAG9BlB,EAAAc,UAAAK,OAAA,eAAAC,EAAAlB,KACI,MAAM,CACFmB,EAAK,OAAAC,IAAA,2CAAAC,MAAM,aAAaN,MAAO,CAACO,gBAAiB,YAC7CH,EAAA,OAAAC,IAAA,2CAAKC,MAAM,iBAAiBN,MAAO,CAACQ,SAAU,QAASC,OAAQ,SAC3DL,EAAA,KAAAC,IAAA,2CAAGC,MAAM,iCAAiCN,MAAO,CAACU,SAAU,SAAUzB,KAAKK,SAE3Ec,EAAA,QAAAC,IAAA,2CAAMM,SAAU,SAACC,GAAQ,OAAAT,EAAKU,OAAOD,EAAZ,GACrBR,EAAQ,QAAAC,IAAA,6CAERD,EAAW,aAAAC,IAAA,2CAAAS,OAAM,KAACC,KAAM9B,KAAKM,SAGjCa,EAAA,KAAAC,IAAA,2CAAGW,KAAM/B,KAAKI,iBAAkBW,MAAO,CAACiB,UAAW,SAAUhC,KAAKO,0B,EAM5ET,EAAAc,UAAAgB,OAAN,SAAaD,G,8HACTA,EAAMM,iBAEAC,EAAOlC,KAAKc,KAAKqB,cAAc,QAC/BC,EAAQF,EAAKC,cAAc,0CAC3BE,EAAOH,EAAKC,cAAc,2BAEhC,SAAMC,EAAME,Y,OAAZC,EAAAC,OACA,SAAMH,EAAKC,Y,OAAXC,EAAAC,OAEI,SAAMJ,EAAMK,W,SAAZF,EAAAC,O,kBAAyB,SAAMH,EAAKI,W,SAAXF,EAAAC,O,uBAAzB,YACIE,EAAU,IAAIC,QAClBD,EAAQE,OAAO,SAAU,YACzBF,EAAQE,OAAO,gBAAiB,YAE1BC,EAAW,IAAIC,SAASZ,GAEb,SAAMa,MAAM/C,KAAKC,IAAK,CACnC+C,KAAMH,EACNI,OAAQ,OACRP,QAASA,EACTQ,YAAa,gBACdC,MAAK,SAAAC,GAAY,OAAAA,EAASC,MAAT,K,OALdD,EAAWb,EAAAC,OAOjB,GAAGY,GAAY,QACXf,EAAKiB,QAAUtD,KAAKG,qBAEnB,GAAGiD,GAAY,OAAQ,CACxBpD,KAAKuD,YAAYV,E,oCAKvB/C,EAAAc,UAAA2C,YAAN,SAAkBC,G,wHAEVd,EAAU,IAAIC,QAClBD,EAAQE,OAAO,SAAU,YACzBF,EAAQE,OAAO,gBAAiB,YAE1BC,EAAW,IAAIC,SACrBD,EAASY,IAAI,OAAQ,SAAAC,OAASC,mBAAmBH,EAAKI,IAAI,SAASC,YAAW,WAAAH,OAAUC,mBAAmBH,EAAKI,IAAI,SAASC,cAE5G,SAAMd,MAAM/C,KAAKE,OAAQ,CACtC8C,KAAMH,EACNI,OAAQ,OACRP,QAASA,EACTQ,YAAa,gBACdC,MAAK,SAAAC,GAAY,OAAAA,EAASC,MAAT,K,OALdD,EAAWU,EAAAtB,OAOXuB,EAASC,SAASC,cAAc,yBACtCF,EAAOG,aAAa,UAAWlE,KAAKS,eACpCsD,EAAOG,aAAa,UAAWlE,KAAKU,cACpCqD,EAAOG,aAAa,kBAAmBlE,KAAKW,sBAE5C,GAAGyC,EAASe,OAAO,iBAAkB,EAAI,CACrCJ,EAAOG,aAAa,UAAWlE,KAAKQ,oB,CAGxCwD,SAAShB,KAAKoB,YAAYL,G,yIAlGX,G","ignoreList":[]}
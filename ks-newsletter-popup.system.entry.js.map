{"version":3,"names":["newsletterPopupCss","NewsletterPopup","exports","class_1","hostRef","this","displayOnLoad","loggedIn","subscribed","agreement","infoMessage","successHeading","successUnsubHeading","faliureHeading","success","prototype","componentDidLoad","_this","dialog","root","querySelector","document","cookie","search","setTimeout","Show","requestHandler","event","preventDefault","ValidateInput","_a","sent","showLoading","target","data","FormData","append","email","fetch","api","body","method","then","response","__awaiter","text","result","heading","showSuccess","replace","track","showFailure","catch","error","message","window","navigator","onLine","subscriber","place","DataLayer","subscribe","setSubscription","customer","commonDynamic","get","set","show","SetCookie","expiration","expirationDate","Date","setMonth","getMonth","toUTCString","render","h","key","dark","smallmobile","nopadding","onClosed","onSubmit","e","class","viewBox","width","height","x","y","tall","name","link","loginLink","registerLink","large","required","nomessage","label","submit","secondary"],"sources":["src/components/base/popups/newsletter-popup.css?tag=ks-newsletter-popup","src/components/base/popups/newsletter-popup.tsx"],"sourcesContent":["ks-newsletter-popup {\n    display: block;\n}\n\nks-newsletter-popup form {\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n\n    height: 100%;\n    width: 100%;\n    max-width: 720px;\n}\n\nks-newsletter-popup .info {\n    padding: 60px 60px 20px 60px;\n    fill: #252525;\n\n    flex: 1 0 auto;\n    min-height: 10px;\n}\n\nks-newsletter-popup .info .top {\n    width: 100%;\n    margin-bottom: 10px;\n    font-size: initial;\n    max-height: 30px;\n}\n\nks-newsletter-popup .info .heading {\n    width: 100%;\n    font-family: var(--font-emphasis);\n    font-size: initial;\n    max-height: 80px;\n    margin-bottom: 10px;\n}\n\nks-newsletter-popup .info p {\n    text-align: center;\n    margin-top: 10px;\n}\n\nks-newsletter-popup .buttons {\n    display: flex;\n    flex-wrap: wrap;\n    min-height: 10px;\n    margin-top: 30px;\n}\n\nks-newsletter-popup .buttons > * {\n    flex: 1;\n}\n\nks-newsletter-popup .close {\n    color: black !important;\n}\n\nks-newsletter-popup ks-input-check {\n    margin: 20px;\n\n    font-size: 13px;\n    line-height: 18px;\n}\n\nks-newsletter-popup .email-form {\n    display: flex;\n}\n\nks-newsletter-popup .email-form > * { margin-bottom: 0px; }\nks-newsletter-popup .email-form > * input { height: 60px; }\nks-newsletter-popup .email-form > ks-button { width: 30%; }\nks-newsletter-popup .email-form > ks-input-text { width: 100%; }\n\nks-newsletter-popup .email {\n    flex: 1 0 0;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    background-color: #e5e5e5;\n    color: black;\n    font-size: 18px;\n    min-height: 50px;\n}\n\n@media (max-width: 720px) {\n    ks-newsletter-popup .info .heading {\n        max-height: 50px;\n    }\n\n    ks-newsletter-popup .email {\n        font-size: 16px;\n    }\n}\n\n@media (max-width: 540px) {\n    ks-newsletter-popup .info {\n        padding: 70px 25px 20px 25px;\n        min-height: 180px;\n    }\n\n    ks-newsletter-popup .info .top {\n        display: none;\n    }\n\n    ks-newsletter-popup .info p {\n        font-size: 13px;\n    }\n\n    ks-newsletter-popup ks-input-check {\n        font-size: 11px;\n        line-height: 16px;\n    }\n\n    ks-newsletter-popup .email-form {\n        display: block;\n    }\n    \n    ks-newsletter-popup .email-form > ks-button { width: 100%; }\n\n    ks-newsletter-popup .buttons { \n        display: block;\n        margin-top: 0px;\n    }\n    ks-newsletter-popup .buttons > *:first-child { border-bottom: 1px solid #3a3a3a; }\n\n    ks-newsletter-popup ks-input-check {\n        margin: 15px;\n    }\n\n    ks-newsletter-popup .info .heading {\n        width: 100%;\n        max-height: 40px;\n    }\n}","import { Component, h, Prop, Element, Method } from '@stencil/core';\nimport ValidateInput from '../../input/validate';\ndeclare var ksNewsletterToken: any;\n\nimport { commonDynamic, SubscriptionData } from \"../../../global/data/commonDynamic\";\nimport { DataLayer } from '../../../global/dataLayer';\n\n@Component({\n  tag: 'ks-newsletter-popup',\n  styleUrl: 'newsletter-popup.css'\n})\nexport class NewsletterPopup{\n    @Element() root: HTMLElement;\n    dialog: HTMLKsDialogElement;\n\n    @Prop() api: string;\n    @Prop() loginLink: string;\n    @Prop() registerLink: string;\n\n    @Prop() displayOnLoad: boolean = false;\n\n    @Prop() loggedIn: boolean = false;\n    @Prop({mutable: true}) subscribed: boolean = false;\n    @Prop() email: string;\n\n    @Prop() agreement: string = \"Wyrażam zgodę na przetwarzanie danych osobowych do celów marketingowych, w celu zbadania opinii o sklepie oraz na otrzymywanie informacji handlowych na wskazany przeze mnie adres e-mail.\";\n    @Prop() infoMessage: string = \"Aby otrzymać kupon rabatowy musisz posiadać konto w naszym sklepie. Minimalna wartość zamówienia wynosi: 100,00 zł\";\n\n    @Prop() successHeading: string = \"ZAPISANO DO NEWSLETTERA\";\n    @Prop() successUnsubHeading: string = \"WYPISANO Z NEWSLETTERA\";\n    @Prop() faliureHeading: string = \"BŁĄD ZAPISU\";\n\n    success = false;\n\n    componentDidLoad() {\n        this.dialog = this.root.querySelector(\"ks-dialog\");\n        if(this.displayOnLoad && document.cookie.search(\"newsletterPopup=tak\") == -1) {\n            setTimeout(() => {\n                this.Show();\n            }, 4000);\n        }\n    }\n\n    async requestHandler(event: Event) {\n        event.preventDefault();\n        if(!await ValidateInput(this.root.querySelector('form')))\n            return;\n\n        this.dialog.showLoading();\n\n        const target = event.target as HTMLFormElement;\n        const data = new FormData(target);\n\n        if(this.subscribed)\n        data.append(\"unsubscribe\", \"1\");\n        data.append(\"email\", this.email);\n        data.append(\"popup\", \"1\");\n\n        fetch(this.api, { body: data, method: \"post\"})\n        .then(async response => {\n            const result = await response.text();\n            if(result.search(\"SUCCESS\") != -1) {\n                const heading = this.subscribed ? this.successUnsubHeading : this.successHeading;\n                this.dialog.showSuccess(heading, result.replace(\"SUCCESS\", \"\"));\n                this.track();\n                this.success = true;\n            }\n            else this.dialog.showFailure(this.faliureHeading, result);\n        })\n        .catch(async error => {\n            let message = \"\";\n\n            if(!window.navigator.onLine)\n                message = \"Brak internetu.\"\n\n            if(error.message) message = error.message;\n\n            this.dialog.showFailure(this.faliureHeading, message);\n        });\n    }\n\n    track() {\n        const data: SubscriptionData = {\n            email: this.email,\n            subscriber: !this.subscribed,\n            place: \"Zapis do newslettera | Popup\"\n        }\n\n        DataLayer.subscribe(data);\n    }\n\n    setSubscription() {\n        let customer = commonDynamic.get('customer');\n        customer.subscriber = !this.subscribed;\n        commonDynamic.set('customer', customer);\n        this.subscribed = !this.subscribed;\n    }\n    \n\n    @Method()\n    async Show() {\n        this.dialog.show();\n    }\n\n    SetCookie() {\n        var expiration = \"\";\n        var expirationDate = new Date();\n        expirationDate.setMonth(expirationDate.getMonth() + 1);\n        expiration = \"expires=\" + expirationDate.toUTCString() + \"; \";\n\n        document.cookie = \"newsletterPopup=tak; \" + expiration + \"path=/\";\n\n        if(this.success) {\n            this.setSubscription();\n            this.success = false;\n        }\n    }\n    \n\n  render() {\n    return [\n        <ks-dialog dark smallmobile nopadding onClosed={()=>this.SetCookie()}>\n            <form onSubmit={e => this.requestHandler(e)}>\n                <div class=\"info\">\n                    <svg class=\"top\" viewBox=\"0 0 303 15\" width={909} height={45}>\n                        <text x=\"0\" y=\"12\">Zapisz się do naszego Newslettera i zyskaj</text>\n                    </svg>\n\n                    <svg class=\"heading\" viewBox=\"0 0 96 12\" width={960} height={130}>\n                        <text x=\"-1\" y=\"12\">KUPON 10ZŁ</text>\n                    </svg>\n\n                    <p>{this.infoMessage}</p>\n                </div>\n                    \n                {!this.loggedIn ?\n                    <div class=\"buttons\">\n                        <ks-button tall name=\"ZALOGUJ SIĘ\" link={this.loginLink}></ks-button>\n                        <ks-button tall name=\"NOWE KONTO\" link={this.registerLink}></ks-button>\n                    </div>\n                : [\n                    this.subscribed ? null : <ks-input-check large required nomessage name=\"zgoda\" label={this.agreement} />,\n                    <div class=\"email-form\">\n                        <div class=\"email\">{this.email}</div>\n                        <ks-button submit secondary={this.subscribed} name={this.subscribed ? \"WYPISZ SIĘ\" : \"ZAPISZ SIĘ\"} />\n                    </div>\n                ]}\n            </form>\n        </ks-dialog>\n    ];\n  }\n}\n"],"mappings":"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","ignoreList":[]}
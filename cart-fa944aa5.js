import{c as n}from"./cart-b9df7a0c.js";import{f as a,j as t}from"./fetch-bbb23998.js";import{I as c,C as s}from"./inpost-pay-70a74568.js";async function i(a){const t=await P((async()=>$(n.get("api").productRemove,{id:a})));t&&(0==t.products.length?document.location.reload():B("Błąd usuwania produktu",t,(async n=>{v(n),"discount"in n==0&&this.RemoveDiscount()})));const c=document.querySelector(`ks-cart-product[ikey="${a}"]`);c&&c.ResetLoading()}var o={};async function u(n,a,t){o[n]?o[n]=()=>d(n,a,t):(o[n]=()=>{},d(n,a,t).then((()=>{o[n]&&(o[n](),o[n]=void 0)})))}async function d(a,t,s){const i=await P((async()=>$(n.get("api").productCount,{id:a,ilosc:t.toString()})));i?B("Błąd ilości produktu",i,(async t=>{"error"in t?(x().show("Błąd ilości produktu",t.error.message),n.set("products",r(a,t.error.amount,t.error.maxAmount))):await v(t),"discount"in t==0&&k()})):(n.set("products",r(a,s)),this.SetAmount(s,`ks-cart-product[ikey="${a}"] ks-cart-spinner`),c(t))}function r(a,t,c){const s=n.get("products");return s[a].quantity=t,c&&(s[a].maxQuantity=c),s}async function e(a){n.set("loadingDeals",!0);const t=await $(n.get("api").addDeal,{id:a});if(n.set("loadingDeals",!1),t&&!("error"in t)){await v(t);for(const a in n.get("products")){const t=n.get("products")[a],c=document.querySelector(`ks-cart-product[product-id="${t.id}"] ks-cart-spinner`);null==c||c.SetAmount(t.quantity)}}else x().show("Błąd dodawania gratisu",t.error.message)}async function p(a){b("ks-cart-select-shipping"),b("ks-cart-select-payment"),v(await $(n.get("api").countryChange,{data:a})),j("ks-cart-select-shipping"),j("ks-cart-select-payment")}async function f(a){b("ks-cart-select-payment"),v(await $(n.get("api").shippingChange,{data:a.toString()})),j("ks-cart-select-payment")}async function l(a){v(await $(n.get("api").paymentChange,{data:a.toString()}))}async function y(){v(await $(n.get("api").discountRemove)),k()}function k(){n.set("discount",{})}async function m(a){B("Błąd dodawania kodu",await $(n.get("api").discountCode,{data:a}),(n=>{v(n)})),j("ks-cart-discount-code")}async function g(a){const t=await $(n.get("api").discountPoints,{data:a.toString()});!function(){const n=document.querySelectorAll("ks-cart-discount-container ks-cart-heading");let a=0;2==n.length&&(a=n[1].getBoundingClientRect().top-n[0].getBoundingClientRect().top),a&&window.scrollBy(0,-a)}(),v(t),j("ks-cart-discount-points")}async function w(a){const c=n.get("api").easyprotectChange;D(),await t(c,a).then((n=>n.json())).then((n=>v(n))),L()}async function h(t){const c=n.get("api").easyprotectRemove;D(),await a(c,{id:t}).then((n=>n.json())).then((n=>v(n))),L()}function b(n){const a=document.querySelector(n);a&&"StartLoading"in a&&a.StartLoading()}function j(n){const a=document.querySelector(n);a&&"ResetLoading"in a&&a.ResetLoading()}async function B(n,a,t){"message"in a?(x().show(n,a.message),delete a.message,setTimeout((()=>{t(a)}),200)):t(a)}async function P(a){n.set("loadingProducts",n.get("loadingProducts")+1);const t=await a();return n.set("loadingProducts",n.get("loadingProducts")-1),t}async function $(n,t){return D(),a(n,t).then((n=>n.json())).then((n=>(L(),n))).catch((n=>(L(),document.querySelector("ks-error-popup").show(n),{})))}function v(a){Object.keys(a).map((t=>{n.set(t,a[t])})),s(0)}function D(){n.set("loading",n.get("loading")+1)}function L(){n.set("loading",n.get("loading")-1)}function x(){return document.querySelector("ks-message-popup")}export{e as a,l as b,p as c,y as d,m as e,g as f,w as g,h,u as p,i as r,f as s,v as u}
{"version":3,"names":["img3Css","Img3","exports","class_1","prototype","loadHandler","e","target","HTMLElement","_a","getAttribute","includes","this","loaded","lazyLoaded","emit","srcListener","_this","image","root","querySelector","removeAttribute","setAttribute","setTimeout","complete","componentDidLoad","sync","window_load","promise","then","initializeObserver","img","source","closest","parentElement","onIntersection","entries","_i","entries_1","length","entry","isIntersecting","observer","disconnect","IntersectionObserver","rootMargin","observerMargin","observe","render","loading","h","webp","srcSet","type","src","alt","width","height","class","onLoad","dark"],"sources":["src/components/elements/img3.css?tag=ks-img3","src/components/elements/img3.tsx"],"sourcesContent":["ks-img3 {\n    display: block;\n    box-sizing: border-box;\n    font-size: 0;\n\n    max-height: inherit;\n    position: relative;\n}\n\nks-img3 picture {\n    max-height: inherit;\n}\n\nks-img3 img {\n    width: 100%;\n    height: 100%;\n    max-height: inherit;\n    \n    object-position: center;\n\n    opacity: 1;\n    transition: opacity 0.3s ease;\n}\n\nks-img3 img.loading {\n    opacity: 0;\n    height: 0;\n}\n\nks-img3[fit='contain'] img { object-fit: contain; }\nks-img3[fit='cover'] img { object-fit: cover; }\nks-img3[fit='fill'] img { object-fit: fill; }\nks-img3[fit='scale-down'] img { object-fit: scale-down; }\nks-img3[fit='none'] img { object-fit: none; }\n\nks-img3[fit='contain'] canvas { object-fit: contain; }\nks-img3[fit='cover'] canvas { object-fit: cover; }\nks-img3[fit='fill'] canvas { object-fit: fill; }\nks-img3[fit='scale-down'] canvas { object-fit: scale-down; }\nks-img3[fit='none'] canvas { object-fit: none; }\n\nks-img2 canvas {\n    display: inline-block;\n    width: auto;\n    height : auto;\n    max-width: inherit;\n    max-height: inherit;\n    font-size: 0;\n    vertical-align: middle;\n}","import { Component, h, Prop, State, Watch, Element, Event, EventEmitter } from '@stencil/core';\nimport { window_load } from '../deferredpromise';\n@Component({\n    tag: 'ks-img3',\n    styleUrl: \"img3.css\"\n})\nexport class Img3 {\n    @Element() root: HTMLElement;\n    @Prop({reflect: true}) image: string;\n    @Prop() webp: string;\n    @Prop() alt: string;\n    \n    @Prop() target: string;\n    @Prop() observerMargin: string;\n    @Prop() sync: boolean = false;\n\n    @Prop() width: number;\n    @Prop() height: number;\n\n    @Prop({reflect: true}) fit: \"contain\" | \"cover\" | \"fill\" | \"scale-down\" | \"none\";\n\n    @State() loaded: boolean = false;\n\n    @Event() lazyLoaded: EventEmitter;\n    loadHandler(e: Event) {\n        if (e.target instanceof HTMLElement && !e.target.getAttribute(\"src\")?.includes('data:image')) {\n            this.loaded = true;\n            this.lazyLoaded.emit();\n        }\n    }\n    \n    @Watch('image') srcListener() {\n        const image = this.root.querySelector(\"img\");\n        image.removeAttribute(\"src\");\n        image.setAttribute(\"src\", this.image);\n\n        setTimeout(()=>{\n            if(!image.complete) {\n                this.loaded = false;\n            }\n        }, 200);\n    }\n\n    private observer: IntersectionObserver;\n    private img: HTMLImageElement;\n    private source: HTMLSourceElement;\n\n    componentDidLoad() {\n        if(!this.sync)\n            window_load.promise.then(()=>this.initializeObserver());\n    }\n\n    initializeObserver() {\n        this.img = this.root.querySelector('img') as HTMLImageElement;\n        this.source = this.root.querySelector('source') as HTMLSourceElement;\n        const target = this.target ? this.root.closest(this.target) : this.root.parentElement;\n        \n        const onIntersection = (entries)=> {\n            for (const entry of entries) {\n                if (entry.isIntersecting) {\n                    if (this.observer) {\n                        this.observer.disconnect();\n                    }\n                    if (this.source?.getAttribute('data-srcSet')) {\n                        this.source.setAttribute('srcSet', this.source.getAttribute('data-srcSet'));\n                        this.source.removeAttribute('data-srcSet');\n                    }\n                    if (this.img.getAttribute('data-src')) {\n                        this.img.setAttribute('src', this.img.getAttribute('data-src'));\n                        this.img.removeAttribute('data-src');\n                    }\n                }\n            }\n        }\n\n        if (this.image && target) {\n            this.observer = new IntersectionObserver(onIntersection, {\n                rootMargin: this.observerMargin\n            });\n            this.observer.observe(target);\n        }\n    }\n\n\trender() {\n        const loading = this.loaded ? \"\" : \"loading\";\n\n        if(this.sync) return [\n            <picture>\n                {this.webp ? <source srcSet={this.webp} type=\"image/webp\"/> : null}\n                <img src={this.image} alt={this.alt} width={this.width} height={this.height} />\n            </picture>,\n        ];\n\n        return [\n            <picture>\n                {this.webp ? <source data-srcSet={this.webp} type=\"image/webp\"/> : null}\n                <img class={loading} onLoad={(e)=>this.loadHandler(e)} data-src={this.image}\n                    alt={this.alt} width={this.width} height={this.height} />\n            </picture>,\n\n            (!this.loaded ? [\n                <ks-loader dark />,\n                <canvas width={this.width} height={this.height} />\n            ] : null)\n        ];\n\t}\n}\n"],"mappings":"0NAAA,IAAMA,EAAU,spC,ICMHC,EAAIC,EAAA,qB,yLAQW,M,0EAOG,K,CAG3BC,EAAAC,UAAAC,YAAA,SAAYC,G,MACR,GAAIA,EAAEC,kBAAkBC,gBAAgBC,EAAAH,EAAEC,OAAOG,aAAa,UAAM,MAAAD,SAAA,SAAAA,EAAEE,SAAS,eAAe,CAC1FC,KAAKC,OAAS,KACdD,KAAKE,WAAWC,M,GAIRZ,EAAAC,UAAAY,YAAA,eAAAC,EAAAL,KACZ,IAAMM,EAAQN,KAAKO,KAAKC,cAAc,OACtCF,EAAMG,gBAAgB,OACtBH,EAAMI,aAAa,MAAOV,KAAKM,OAE/BK,YAAW,WACP,IAAIL,EAAMM,SAAU,CAChBP,EAAKJ,OAAS,K,IAEnB,I,EAOPV,EAAAC,UAAAqB,iBAAA,eAAAR,EAAAL,KACI,IAAIA,KAAKc,KACLC,EAAYC,QAAQC,MAAK,WAAI,OAAAZ,EAAKa,oBAAL,G,EAGrC3B,EAAAC,UAAA0B,mBAAA,eAAAb,EAAAL,KACIA,KAAKmB,IAAMnB,KAAKO,KAAKC,cAAc,OACnCR,KAAKoB,OAASpB,KAAKO,KAAKC,cAAc,UACtC,IAAMb,EAASK,KAAKL,OAASK,KAAKO,KAAKc,QAAQrB,KAAKL,QAAUK,KAAKO,KAAKe,cAExE,IAAMC,EAAiB,SAACC,G,MACpB,IAAoB,IAAAC,EAAA,EAAAC,EAAAF,EAAAC,EAAAC,EAAAC,OAAAF,IAAS,CAAxB,IAAMG,EAAKF,EAAAD,GACZ,GAAIG,EAAMC,eAAgB,CACtB,GAAIxB,EAAKyB,SAAU,CACfzB,EAAKyB,SAASC,Y,CAElB,IAAIlC,EAAAQ,EAAKe,UAAM,MAAAvB,SAAA,SAAAA,EAAEC,aAAa,eAAgB,CAC1CO,EAAKe,OAAOV,aAAa,SAAUL,EAAKe,OAAOtB,aAAa,gBAC5DO,EAAKe,OAAOX,gBAAgB,c,CAEhC,GAAIJ,EAAKc,IAAIrB,aAAa,YAAa,CACnCO,EAAKc,IAAIT,aAAa,MAAOL,EAAKc,IAAIrB,aAAa,aACnDO,EAAKc,IAAIV,gBAAgB,W,KAMzC,GAAIT,KAAKM,OAASX,EAAQ,CACtBK,KAAK8B,SAAW,IAAIE,qBAAqBT,EAAgB,CACrDU,WAAYjC,KAAKkC,iBAErBlC,KAAK8B,SAASK,QAAQxC,E,GAIjCJ,EAAAC,UAAA4C,OAAA,eAAA/B,EAAAL,KACO,IAAMqC,EAAUrC,KAAKC,OAAS,GAAK,UAEnC,GAAGD,KAAKc,KAAM,MAAO,CACjBwB,EAAA,eACKtC,KAAKuC,KAAOD,EAAA,UAAQE,OAAQxC,KAAKuC,KAAME,KAAK,eAAiB,KAC9DH,EAAA,OAAKI,IAAK1C,KAAKM,MAAOqC,IAAK3C,KAAK2C,IAAKC,MAAO5C,KAAK4C,MAAOC,OAAQ7C,KAAK6C,WAI7E,MAAO,CACHP,EAAA,eACKtC,KAAKuC,KAAOD,EAAA,wBAAqBtC,KAAKuC,KAAME,KAAK,eAAiB,KACnEH,EAAA,OAAKQ,MAAOT,EAASU,OAAQ,SAACrD,GAAI,OAAAW,EAAKZ,YAAYC,EAAjB,EAAmB,WAAYM,KAAKM,MAClEqC,IAAK3C,KAAK2C,IAAKC,MAAO5C,KAAK4C,MAAOC,OAAQ7C,KAAK6C,WAGrD7C,KAAKC,OAAS,CACZqC,EAAA,aAAWU,KAAI,OACfV,EAAA,UAAQM,MAAO5C,KAAK4C,MAAOC,OAAQ7C,KAAK6C,UACxC,K,gPAjGC,I"}
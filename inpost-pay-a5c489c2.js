import{f as n,j as t}from"./fetch-1f8a9006.js";import{c as a}from"./commonDynamic-5e51121d.js";import{c as i}from"./cart-75f4ee6e.js";import{D as o}from"./dataLayer-452698da.js";async function c(n){var t;const a=null===(t=i.get("products"))||void 0===t?void 0:t[n];a&&o.removeFromCart(a);const c=await $(i.get("api").productRemove,{id:n});c&&(0==c.products.length?document.location.reload():j("Błąd usuwania produktu",c,(async n=>{h(n)})));const s=document.querySelector(`ks-cart-product[ikey="${n}"]`);s&&s.ResetLoading()}var s=new AbortController;async function e(n,t){s.abort(),s=new AbortController;const a=await $(i.get("api").productCount,{id:n,ilosc:t.toString()},s.signal);a&&j("Błąd ilości produktu",a,(async n=>{"error"in n?A().show("Błąd ilości produktu",n.error.message):h(n),"discount"in n==0&&f()}))}async function r(n){i.set("loadingDeals",!0);const t=await $(i.get("api").addDeal,{id:n});i.set("loadingDeals",!1),t&&!("error"in t)?await h(t):A().show("Błąd dodawania gratisu",t.error.message)}async function d(n){k("ks-cart-select-shipping"),k("ks-cart-select-payment"),h(await $(i.get("api").countryChange,{data:n})),b("ks-cart-select-shipping"),b("ks-cart-select-payment")}async function u(n){k("ks-cart-select-payment"),h(await $(i.get("api").shippingChange,{data:n.toString()})),b("ks-cart-select-payment")}async function p(n){h(await $(i.get("api").paymentChange,{data:n.toString()}))}async function w(){h(await $(i.get("api").discountRemove)),f()}function f(){i.set("discount",{})}async function l(n){j("Błąd dodawania kodu",await $(i.get("api").discountCode,{data:n}),(n=>{h(n)})),b("ks-cart-discount-code")}async function m(n){const t=await $(i.get("api").discountPoints,{data:n.toString()});!function(){const n=document.querySelectorAll("ks-cart-discount-container ks-cart-heading");let t=0;2==n.length&&(t=n[1].getBoundingClientRect().top-n[0].getBoundingClientRect().top),t&&window.scrollBy(0,-t)}(),h(t),b("ks-cart-discount-points")}async function y(n){const a=i.get("api").easyprotectChange;v(),await t(a,n).then((n=>n.json())).then((n=>h(n))),C()}async function g(t){const a=i.get("api").easyprotectRemove;v(),await n(a,{id:t}).then((n=>n.json())).then((n=>h(n))),C()}function k(n){const t=document.querySelector(n);t&&"StartLoading"in t&&t.StartLoading()}function b(n){const t=document.querySelector(n);t&&"ResetLoading"in t&&t.ResetLoading()}async function j(n,t,a){"message"in t?(A().show(n,t.message),delete t.message,setTimeout((()=>{a(t)}),200)):a(t)}async function $(t,a,i){return v(),n(t,a,i).then((n=>n.json())).then((n=>(C(),n))).catch((n=>(C(),"AbortError"!=n.name&&document.querySelector("ks-error-popup").show(n),{})))}function h(n,t=!0){Object.keys(n).map((t=>{i.set(t,n[t])})),"discount"in n==0&&f(),t&&L(0)}function v(){i.set("loading",i.get("loading")+1)}function C(){i.get("loading")>0&&i.set("loading",i.get("loading")-1)}function A(){return document.querySelector("ks-message-popup")}function B(){const n=a.get("api").inpostFrontend;return t(`${n}/getbinding`,{}).then((n=>n.json()))}window.iziGetPayData=(n,i,o)=>{const c=a.get("api").inpostFrontend,s=window.iziGetBrowserData();return t(`${c}/getpaydata`,{browser:s,phonePrefix:n,phoneNumber:i,bindingPlace:o}).then((n=>n.json()))};var D=new AbortController,P=!1;function T(){if(P)return;P=!0;const n=a.get("api").inpostFrontend,o=()=>t(`${n}/detectchanges`,{},D.signal).then((n=>n.json())).then((n=>{n.cartUpdated&&async function(){h(await $(i.get("api").reload),!1)}(),setTimeout(o,200)}));setTimeout(o,1500)}function L(n){window.iziCanBeBound(n).then((t=>t?window.iziAddToCart(n):null))}window.iziGetIsBound=()=>{const n=a.get("api").inpostFrontend;return async function(n,t=0,a=200){const i=async(o,c,s)=>{if(t>0&&s>=t)return void c();const e=await n();e&&0!==Object.keys(e).length?o(e):setTimeout((()=>i(o,c,s+1)),a)};return new Promise(((n,t)=>i(n,t,0)))}((()=>t(`${n}/isbound`,{}).then((n=>n.json())).catch((()=>null))),0,1500).then((n=>(Object.keys(n).length>0&&T(),n)))},window.iziGetOrderComplete=()=>Promise.resolve({action:"string",redirect:"string"}),window.iziBindingDelete=()=>{const n=a.get("api").inpostFrontend;return t(`${n}/bindingdelete`,{}).then((n=>n.json()))},window.iziCanBeBound=n=>{const i=a.get("api").inpostFrontend;return t(`${i}/canbebound`,{product_id:n}).then((n=>n.json()))},window.iziAddToCart=n=>{const i=a.get("api").inpostFrontend;return t(`${i}/addtocart`,{product_id:n}).then((n=>n.json())).then((n=>function(n){console.log("InpostUpdateCount");const t=new CustomEvent("inpost-update-count",{detail:n});Array.from(document.getElementsByTagName("inpost-izi-button")).forEach((n=>n.dispatchEvent(t)))}(n.product_count)))},window.iziMobileLink=()=>{const n=a.get("api").inpostFrontend;return t(`${n}/mobilelink`,{}).then((n=>n.json()))};export{L as C,r as a,m as b,d as c,l as d,y as e,w as f,g,e as h,B as i,T as j,p,c as r,u as s,h as u}
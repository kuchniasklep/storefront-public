{"version":3,"names":["loginCss","PageLogin","exports","class_1","hostRef","this","heading","loggedIn","register","recovery","recovery_paragraph","recovery_message","recoveryCheckFailedMessage","success_heading","success_message","failure_heading","failure_message","loading","prototype","componentDidLoad","redirect_to_account","render","_this","h","Host","key","class","id","enctype","onSubmit","event","submit_login","email","required","name","label","icon","password","rounded","primary","tall","submit","border","link","registerLink","onClick","show_recovery","dark","action","recoveryApi","method","check_account_before_recovery","type","value","ip","host","notification_heading","notification_message","hide_notification","close","large","dialog","root","querySelector","show","setTimeout","window","location","href","accountLink","hide_recovery","hide","show_notification","message","preventDefault","form","ValidateInput","_a","sent","filteredParams","URLSearchParams","FormData","forEach","append","toString","formData","headers","Headers","fetch","loginApi","body","credentials","then","response","ok","status","text","includes","catch","error","console","log","navigator","onLine","Number","isInteger","concat","recoveryCheckApi","submit_recovery"],"sources":["src/components/pages/login/login.css?tag=ks-page-login","src/components/pages/login/login.tsx"],"sourcesContent":["ks-page-login {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex: 1 1 auto;\n    \n}\n\nks-page-login .container {\n    max-width: 100%;\n    width: 500px;\n    padding: 30px;\n    background-color: #fff;\n    border-radius: 10px;\n}\n\nks-page-login .buttons {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    margin-top: 30px;\n}\n\nks-page-login .container > h1 {\n    text-align: center;\n    margin: 10px 0px 5px 0px;\n}\n\n\nks-page-login .success {\n    text-align: center;\n}\n\nks-page-login .success .loader {\n    position: relative;\n    width: 100px;\n    height: 100px;\n    margin: auto;\n}\n\nks-page-login ks-dialog .content {\n    width: 100%;\n}\n\nks-page-login #notification-dialog section ks-button {\n    margin-top: 20px;\n}\n\nks-page-login .login > * {\n    font-size: 18px;\n    font-weight: 700;\n    font-family: var(--font-emphasis);\n}\n\n@media (max-width: 1060px) {\n    ks-page-login {\n        background-color: #fff;\n    }\n\n    ks-page-login .container {\n        padding: 40px 20px;\n    }\n}","import { Component, h, Host, Prop, Element, State } from '@stencil/core';\nimport ValidateInput from '../../input/validate';\n\n@Component({\n    tag: 'ks-page-login',\n    styleUrl: 'login.css'\n})\nexport class PageLogin {\n    @Element() root: HTMLElement;\n    \n    @Prop() heading: string = \"Logowanie do sklepu\";\n    @Prop() loggedIn: boolean = false;\n    @Prop() ip: string;\n    @Prop() host: string;\n\n    @Prop() loginApi: string;\n    \n    @Prop() register: string = \"Zarejestruj się\";\n    @Prop() registerLink: string;\n    @Prop() accountLink: string;\n    \n    @Prop() recovery: string = \"Odzyskiwanie hasła\";\n    @Prop() recovery_paragraph: string = \"Jeżeli nie pamiętasz hasła, wpisz swój adres e-mail, a my prześlemy do Ciebie wiadomość z nowym hasłem.\";\n    @Prop() recovery_message: string = \"Nowe hasło zostało wysłane na adres email podany w formularzu\";\n    @Prop() recoveryApi: string;\n    @Prop() recoveryCheckApi: string;\n    @Prop() recoveryCheckFailedMessage: string = \"Konto z podanym adresem email nie istnieje u nas w bazie danych\";\n\n    @Prop() success_heading: string = \"Zalogowano\";\n    @Prop() success_message: string = \"Zostałeś pomyślnie zalogowany/a, za chwilę nastąpi przekierowanie na panel klienta.\";\n\n    @Prop() failure_heading: string = \"Nie zalogowano\";\n    @Prop() failure_message: string = \"Błędny adres email oraz hasło, spróbuj wprowadzić je ponownie lub skorzystaj z funkcji odzyskiwania hasła.\";\n    \n    @State() loading: boolean = false;\n    @State() notification_heading: string;\n    @State() notification_message: string;\n\n    componentDidLoad() {\n        if(this.loggedIn) this.redirect_to_account();\n    }\n\n\trender() {\n\t\treturn <Host>\n            <section class=\"container\">\n                <h1>{this.heading}</h1>\n\n                <form id=\"login\" enctype=\"application/x-www-form-urlencoded\" onSubmit={(event)=>this.submit_login(event)}>\n                    <ks-input-text email required name='email' label=\"Adres email\" icon=\"mail\" />\n                    <ks-input-text password required name='haslo' label=\"Hasło\" icon=\"key\" />\n\n                    <div class=\"buttons\">\n                        <ks-button rounded primary tall submit name=\"Zaloguj się\" loading={this.loading} class=\"login\" />\n                        <ks-button rounded border link={this.registerLink} name={this.register} loading={this.loading} />\n                        <ks-button rounded border onClick={() => this.show_recovery()} name={this.recovery} loading={this.loading} />\n                    </div>\n                </form>\n\n                <ks-dialog id=\"recovery-dialog\" dark>\n                    <section>\n                        <h1>{this.recovery}</h1>\n                        <p>{this.recovery_paragraph}</p>\n                        <form action={this.recoveryApi} method='post' id=\"recovery\" enctype=\"application/x-www-form-urlencoded\" onSubmit={(event)=>this.check_account_before_recovery(event)}>\n                            <input type=\"hidden\" name=\"adres_ip\" value={this.ip} />\n                            <input type=\"hidden\" name=\"nazwa_hosta\" value={this.host} />\n                            <ks-input-text email required name='emailprzypomnienie' label=\"Adres email\" icon=\"mail\" />\n                            <ks-button rounded submit name=\"Wyślij\" loading={this.loading} />\n                        </form>\n                    </section>\n                </ks-dialog>\n\n                <ks-dialog id=\"notification-dialog\" dark>\n                    <section>\n                        <h1>{this.notification_heading}</h1>\n                        <p>{this.notification_message}</p>\n\n                        <ks-button rounded onClick={()=>this.hide_notification()} name=\"Wróć do logowania\" />\n                    </section>\n                </ks-dialog>\n\n                <ks-overlay dark id=\"loading-overlay\" close={false}>\n                    <div class=\"success\">\n                        <h1>{this.success_heading}</h1>\n                        <p>{this.success_message}</p>\n                        <div class=\"loader\">\n                            <ks-loader large />\n                        </div>\n                    </div>\n                </ks-overlay>\n            </section>\n        </Host>;\n\t}\n\n    redirect_to_account() {\n        const dialog = this.root.querySelector(\"#loading-overlay\") as any;\n        dialog.show();\n\n        setTimeout(() => {\n            window.location.href = this.accountLink;\n        }, 1000);\n    }\n\n    show_recovery() {\n        const dialog = this.root.querySelector(\"#recovery-dialog\") as any;\n        dialog.show();\n    }\n\n    hide_recovery() {\n        const dialog = this.root.querySelector(\"#recovery-dialog\") as any;\n        dialog.hide();\n    }\n\n    show_notification(heading: string, message: string) {\n        this.hide_recovery();\n        this.notification_heading = heading;\n        this.notification_message = message;\n\n        const dialog = this.root.querySelector(\"#notification-dialog\") as any;\n        dialog.show();\n    }\n\n    hide_notification() {\n        const dialog = this.root.querySelector(\"#notification-dialog\") as any;\n        dialog.hide();\n    }\n\n    async submit_login(event: Event) {\n        event.preventDefault();\n        this.loading = true;\n\n        const form = this.root.querySelector(\"#login\") as HTMLFormElement;\n\n        if(!await ValidateInput(form)) {\n            this.loading = false;\n            return;\n        }\n\n        const filteredParams = new URLSearchParams();\n\n        new FormData(form).forEach((value, key) => {\n            filteredParams.append(key, value.toString());\n        })\n\n        const formData = new FormData();\n        formData.append(\"data\", filteredParams.toString());\n\n        var headers = new Headers();\n        headers.append('pragma', 'no-cache');\n        headers.append('cache-control', 'no-cache');\n\n        await fetch(this.loginApi, {\n            body: formData,\n            method: 'POST',\n            headers: headers,\n            credentials: \"same-origin\"\n        })\n        .then(response => {\n            if(!response.ok) throw response.status;\n            return response.text();\n        })\n        .then(response => {\n            if(response.includes(\"Błąd\"))\n                this.show_notification(this.failure_heading, this.failure_message);\n            else this.redirect_to_account();\n        })\n        .catch(error => {\n            console.log(error);\n            let message = error;\n\n            if(!navigator.onLine)\n                message = \"Brak połączenia z internetem.\";\n\n            else if(Number.isInteger(error))\n                message = `Błąd połączenia - ${error}`;\n\n            this.show_notification(this.failure_heading, message);\n        });\n\n        this.loading = false;\n    }\n\n    async check_account_before_recovery(event: Event) {\n        event.preventDefault();\n        this.loading = true;\n\n        const form = this.root.querySelector(\"#recovery\") as HTMLFormElement;\n\n        if(!await ValidateInput(form)) {\n            this.loading = false;\n            return;\n        }\n\n        const filteredParams = new URLSearchParams();\n\n        new FormData(form).forEach((value, key) => {\n            if(key == \"emailprzypomnienie\")\n                filteredParams.append(key, value.toString());\n        })\n\n        var headers = new Headers();\n        headers.append('pragma', 'no-cache');\n        headers.append('cache-control', 'no-cache');\n\n        await fetch(`${this.recoveryCheckApi}&${filteredParams.toString()}`, {\n            method: 'POST',\n            headers: headers,\n            credentials: \"same-origin\"\n        })\n        .then(response => {\n            if(!response.ok) throw response.status;\n            return response.text();\n        })\n        .then(response => {\n            this.loading = false;\n\n            if(response.includes(\"false\"))\n                this.show_notification(this.recovery, this.recoveryCheckFailedMessage);\n            else this.submit_recovery(event);\n        })\n        .catch(error => {\n            console.log(error);\n            let message = error;\n\n            if(!navigator.onLine)\n                message = \"Brak połączenia z internetem.\";\n\n            else if(Number.isInteger(error))\n                message = `Błąd połączenia - ${error}`;\n\n            this.show_notification(this.recovery, message);\n            this.loading = false;\n        });\n    }\n\n    async submit_recovery(event: Event) {\n        event.preventDefault();\n        this.loading = true;\n\n        const form = this.root.querySelector(\"#recovery\") as HTMLFormElement;\n\n        if(!await ValidateInput(form)) {\n            this.loading = false;\n            return;\n        }\n\n        const filteredParams = new URLSearchParams();\n\n        new FormData(form).forEach((value, key) => {\n            filteredParams.append(key, value.toString());\n        })\n\n        const formData = new FormData();\n        formData.append(\"data\", filteredParams.toString());\n\n        var headers = new Headers();\n        headers.append('pragma', 'no-cache');\n        headers.append('cache-control', 'no-cache');\n\n        await fetch(this.recoveryApi, {\n            body: formData,\n            method: 'POST',\n            headers: headers,\n            credentials: \"same-origin\"\n        })\n        .then(response => {\n            if(!response.ok) throw response.status;\n            this.show_notification(this.recovery, this.recovery_message);\n        })\n        .catch(error => {\n            console.log(error);\n            let message = error;\n\n            if(!navigator.onLine)\n                message = \"Brak połączenia z internetem.\";\n\n            else if(Number.isInteger(error))\n                message = `Błąd połączenia - ${error}`;\n\n            this.show_notification(this.recovery, message);\n        });\n\n        this.loading = false;\n    }\n}\n"],"mappings":"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","ignoreList":[]}
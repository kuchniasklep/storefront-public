{"version":3,"names":["passwordCss","PageAccountPassword","exports","class_1","hostRef","this","heading","oldPasswordApi","oldPasswordMessage","dontRedirect","success_heading","success_message","failure_heading","failure_message","loading","prototype","render","_this","h","Host","key","class","id","enctype","onSubmit","event","submit_change","api","message","password","required","name","label","icon","max","passwordCharacters","sameAs","type","value","customerId","rounded","submit","border","link","accountLink","dark","notification_heading","notification_message","onClick","hide_notification","close","large","redirect_to_account","dialog","root","querySelector","show","setTimeout","window","location","href","show_notification","hide","preventDefault","form","ValidateInput","_a","sent","filteredParams","URLSearchParams","FormData","forEach","append","toString","formData","headers","Headers","fetch","changeApi","body","method","credentials","then","response","ok","status","text","includes","catch","error","console","log","navigator","onLine","Number","isInteger","concat"],"sources":["src/components/pages/account/password.css?tag=ks-page-account-password","src/components/pages/account/password.tsx"],"sourcesContent":["ks-page-account-password {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    flex: 1 1 auto;\n    \n}\n\nks-page-account-password .container {\n    max-width: 100%;\n    width: 500px;\n    padding: 30px;\n    background-color: #fff;\n    border-radius: 10px;\n}\n\nks-page-account-password .buttons {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n    margin-top: 30px;\n}\n\nks-page-account-password .container > h1 {\n    text-align: center;\n    margin: 10px 0px 5px 0px;\n}\n\n\nks-page-account-password .success {\n    text-align: center;\n}\n\nks-page-account-password .success .loader {\n    position: relative;\n    width: 100px;\n    height: 100px;\n    margin: auto;\n}\n\nks-page-account-password ks-dialog .content {\n    width: 100%;\n}\n\nks-page-account-password #notification-dialog section ks-button {\n    margin-top: 20px;\n}\n\nks-page-account-password .login > * {\n    font-size: 18px;\n    font-weight: 700;\n    font-family: var(--font-emphasis);\n}\n\n@media (max-width: 1060px) {\n    ks-page-account-password {\n        background-color: #fff;\n    }\n\n    ks-page-account-password .container {\n        padding: 40px 20px;\n    }\n}","import { Component, h, Host, Prop, Element, State } from '@stencil/core';\nimport ValidateInput from '../../input/validate';\n\n@Component({\n    tag: 'ks-page-account-password',\n    styleUrl: 'password.css'\n})\nexport class PageAccountPassword {\n    @Element() root: HTMLElement;\n    \n    @Prop() heading: string = \"Zmiana Hasła\";\n    @Prop() customerId: string;\n\n    @Prop() oldPasswordApi: string = \"res/true?haslo_stare=\";\n    @Prop() oldPasswordMessage: string = \"Wpisane hasło nie jest poprawne\";\n    @Prop() changeApi: string;\n    \n    @Prop() accountLink: string;\n    @Prop() dontRedirect: boolean = false;\n\n    @Prop() success_heading: string = \"Zmieniono hasło\";\n    @Prop() success_message: string = \"Hasło zostało prawidłowo zmienione, za chwilę nastąpi przekierowanie na panel klienta.\";\n\n    @Prop() failure_heading: string = \"Hasło nie zostało zmienione\";\n    @Prop() failure_message: string = \"Spróbuj wprowadzić dane ponownie, jeżeli problem pojawi się ponownie skontaktuj się z obsługą sklepu.\";\n    \n    @State() loading: boolean = false;\n    @State() notification_heading: string;\n    @State() notification_message: string;\n\n\trender() {\n\t\treturn <Host>\n            <section class=\"container\">\n                <h1>{this.heading}</h1>\n\n                <form id=\"change\" enctype=\"application/x-www-form-urlencoded\" onSubmit={(event)=>this.submit_change(event)}>\n                    <ks-input-dynamic api={this.oldPasswordApi} message={this.oldPasswordMessage}>\n                        <ks-input-text password required name='haslo_stare' label=\"Stare hasło\" icon=\"key\" />\n                    </ks-input-dynamic>\n                    <ks-input-text password required name='nowe_haslo' label=\"Nowe hasło\" icon=\"key\" max={128} passwordCharacters />\n                    <ks-input-text password required name='haslo_powtorz' label=\"Powtórz nowe hasło\" icon=\"key\" sameAs=\"nowe_haslo\" />\n\n                    <input type=\"hidden\" name=\"id\" value={this.customerId} />\n                    <input type=\"hidden\" name=\"akcja\" value=\"zapisz\" />\n\n                    <div class=\"buttons\">\n                        <ks-button rounded submit name=\"Zmień hasło\" loading={this.loading} />\n                        <ks-button rounded border link={this.accountLink} name=\"Wróć do panelu klienta\" loading={this.loading} />\n                    </div>\n                </form>\n\n                <ks-dialog id=\"notification-dialog\" dark>\n                    <section>\n                        <h1>{this.notification_heading}</h1>\n                        <p>{this.notification_message}</p>\n\n                        <ks-button rounded onClick={()=>this.hide_notification()} name=\"Wróć do logowania\" />\n                    </section>\n                </ks-dialog>\n\n                <ks-overlay dark id=\"loading-overlay\" close={false}>\n                    <div class=\"success\">\n                        <h1>{this.success_heading}</h1>\n                        <p>{this.success_message}</p>\n                        <div class=\"loader\">\n                            <ks-loader large />\n                        </div>\n                    </div>\n                </ks-overlay>\n            </section>\n        </Host>;\n\t}\n\n    redirect_to_account() {\n        const dialog = this.root.querySelector(\"#loading-overlay\") as any;\n        dialog.show();\n\n        if(this.dontRedirect) return;\n\n        setTimeout(() => {\n            window.location.href = this.accountLink;\n        }, 2000);\n    }\n\n    show_notification(heading: string, message: string) {\n        this.notification_heading = heading;\n        this.notification_message = message;\n\n        const dialog = this.root.querySelector(\"#notification-dialog\") as any;\n        dialog.show();\n    }\n\n    hide_notification() {\n        const dialog = this.root.querySelector(\"#notification-dialog\") as any;\n        dialog.hide();\n    }\n\n    async submit_change(event: Event) {\n        event.preventDefault();\n        this.loading = true;\n\n        const form = this.root.querySelector(\"#change\") as HTMLFormElement;\n\n        if(!await ValidateInput(form)) {\n            this.loading = false;\n            return;\n        }\n\n        const filteredParams = new URLSearchParams();\n\n        new FormData(form).forEach((value, key) => {\n            filteredParams.append(key, value.toString());\n        })\n\n        const formData = new FormData();\n        formData.append(\"data\", filteredParams.toString());\n\n        var headers = new Headers();\n        headers.append('pragma', 'no-cache');\n        headers.append('cache-control', 'no-cache');\n\n        await fetch(this.changeApi, {\n            body: formData,\n            method: 'POST',\n            headers: headers,\n            credentials: \"same-origin\"\n        })\n        .then(response => {\n            if(!response.ok) throw response.status;\n            return response.text();\n        })\n        .then(response => {\n            if(response.includes(\"Twoje hasło zostało zmienione\"))\n                this.redirect_to_account();\n            else this.show_notification(this.failure_heading, this.failure_message);\n        })\n        .catch(error => {\n            console.log(error);\n            let message = error;\n\n            if(!navigator.onLine)\n                message = \"Brak połączenia z internetem.\";\n\n            else if(Number.isInteger(error))\n                message = `Błąd połączenia - ${error}`;\n\n            this.show_notification(this.failure_heading, message);\n        });\n\n        this.loading = false;\n    }\n}\n"],"mappings":"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","ignoreList":[]}
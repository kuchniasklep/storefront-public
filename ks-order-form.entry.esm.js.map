{"version":3,"file":"ks-order-form.entry.esm.js","sources":["src/components/order/shipping/orderForm.tsx"],"sourcesContent":["import { Component, h, Prop, State, Element } from '@stencil/core';\n\nimport { SubscriptionData } from \"../../../global/data/commonDynamic\";\nimport { DataLayer } from '../../../global/dataLayer';\n\n@Component({\n      tag: 'ks-order-form'\n})\nexport class OrderForm {\n\n    @Prop() action: string;\n    @Prop() method: string;\n    @Prop() destination: string;\n    @Prop() button: string;\n    @Prop() back: string;\n\n    @Element() root: HTMLElement;\n\n    @State() loading: boolean = false;\n\n\trender() {\n\n\t\treturn(\n            <form action={this.action} method={this.method} enctype=\"application/x-www-form-urlencoded\" onSubmit={(event)=>this.Submit(event)}>\n                <slot/>\n\n                <div class=\"uk-position-relative uk-margin-medium-top\">\n                    <button type=\"submit\" formnovalidate\n                        class=\"uk-button uk-button-danger uk-width-1-1 ks-text-decorated\"\n                        style={{padding: \"20px\", fontSize: \"28px\", fontWeight: \"700\"}}>\n\n                        <span>{this.button}</span>\n\n                    </button>\n\n                    {this.loading ?\n                        <div class=\"uk-overlay uk-light uk-padding-remove uk-position-cover uk-animation-fade\"\n                            style={{animationDuration: \"0.3s\", backgroundColor: \"#e21334\"}}>\n                            <div uk-spinner=\"ratio: 1.5\" class=\"uk-position-center\"></div>\n                        </div>\n                    : null}\n                </div>\n\n                <ks-order-form-modal back={this.back}></ks-order-form-modal>\n            </form>\n\t\t);\n    }\n\n    async Submit(event: Event) {\n        event.preventDefault();\n\n        const form = this.root.querySelector(\"form\");\n        const inputs = form.querySelectorAll(\"ks-input-dynamic, ks-input-select-dynamic, ks-input-select, ks-input-text, ks-input-check\");\n\n        let highestPosition = Number.MAX_VALUE;\n\n        let valid = true;\n        for (let i = 0; i < inputs.length; i++) {\n            const input = inputs[i] as any;\n            \n            if(input.closest(\"ks-input-dynamic *\") != null) continue;\n\n            if(input.closest(\"ks-order-check-section:not([active])\") != null) continue;\n            if(input.closest(\"ks-order-enable-section:not([active])\") != null) continue;\n            if(input.closest(\"*[hidden]\") != null) continue;\n\n            await input.Validate();\n            if(!await input.IsValid()) {\n                const inputTop = (input as HTMLElement).getBoundingClientRect().top\n                    - document.body.getBoundingClientRect().top;\n\n                if(inputTop < highestPosition)\n                    highestPosition = inputTop;\n\n                valid = false;\n            }\n        }\n\n        if(valid) {\n            const stringArray = new Array<string>();\n            \n            for (let i = 0; i < form.elements.length; i++) {\n                const element = form.elements[i] as HTMLInputElement;\n\n                if( element.nodeName === \"INPUT\" &&\n                    element.type != \"submit\" &&\n                    element.name != \"\"\n                ){\n                    if((element.type == \"checkbox\" || element.type == \"radio\") && !element.checked)\n                        continue;\n\n                    stringArray.push(`${element.name}=${encodeURIComponent(element.value.toString())}`);\n                }\n\n                else if(element.nodeName === \"SELECT\" && element.name != \"\") {\n                    stringArray.push(`${element.name}=${encodeURIComponent(element.value.toString())}`);\n                }\n            }\n\n            const formData = new FormData();\n            formData.append(\"data\", stringArray.join(\"&\") );\n\n            this.loading = true;\n\n            var headers = new Headers();\n            headers.append('pragma', 'no-cache');\n            headers.append('cache-control', 'no-cache');\n\n            await fetch(this.action, {\n                body: formData,\n                method: 'POST',\n                headers: headers,\n                credentials: \"same-origin\"\n            })\n            .then(response => {\n                if(!response.ok)\n                    throw response.status;\n                else {\n                    const email = form.querySelector('input[type=email]') as HTMLInputElement;\n                    const subscription = form.querySelector('input[name=biuletyn]') as HTMLInputElement;\n\n                    this.track(email?.value, subscription?.checked);\n                    window.location.href = this.destination;\n                }\n            })\n            .catch(error => {\n                let message = error;\n\n                console.log(error);\n\n                if(!navigator.onLine)\n                    message = \"Brak połączenia z internetem.\";\n\n                else if(Number.isInteger(error))\n                    message = `Błąd połączenia - ${error}`;\n\n                this.ShowPrompt(message);\n            });\n\n            this.loading = false;\n        }\n\n        else {\n            if('scrollBehavior' in document.documentElement.style)\n                window.scroll({top: highestPosition -100, behavior: \"smooth\"});\n            else window.scroll(0, highestPosition -100);\n        }\n    }\n\n    track(email = \"\", subscription = false) {\n        if(!email || !subscription) return;\n\n        const data: SubscriptionData = {\n            email: email,\n            subscriber: true,\n            place: \"Zapis do newslettera | Rejestracja Zamówienie\"\n        }\n\n        DataLayer.subscribe(data);\n    }\n\n    ShowPrompt(message: string) {\n        const prompt = this.root.querySelector(\"ks-order-form-modal\") as any;\n        prompt.setAttribute(\"message\", message);\n        prompt.Show();\n    }\n}\n"],"names":[],"mappings":"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"}
{"version":3,"file":"ks-newsletter-popup.entry.esm.js","sources":["src/components/base/popups/newsletter-popup.css?tag=ks-newsletter-popup","src/components/base/popups/newsletter-popup.tsx"],"sourcesContent":["ks-newsletter-popup {\n    display: block;\n}\n\nks-newsletter-popup form {\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n\n    height: 100%;\n    width: 100%;\n    max-width: 720px;\n}\n\nks-newsletter-popup .info {\n    padding: 60px 60px 20px 60px;\n    fill: #252525;\n\n    flex: 1 0 auto;\n    min-height: 10px;\n}\n\nks-newsletter-popup .info .top {\n    width: 100%;\n    margin-bottom: 10px;\n    font-size: initial;\n    max-height: 30px;\n}\n\nks-newsletter-popup .info .heading {\n    width: 100%;\n    font-family: var(--font-emphasis);\n    font-size: initial;\n    max-height: 80px;\n    margin-bottom: 10px;\n}\n\nks-newsletter-popup .info p {\n    text-align: center;\n    margin-top: 10px;\n}\n\nks-newsletter-popup .buttons {\n    display: flex;\n    flex-wrap: wrap;\n    min-height: 10px;\n    margin-top: 30px;\n}\n\nks-newsletter-popup .buttons > * {\n    flex: 1;\n}\n\nks-newsletter-popup .close {\n    color: black !important;\n}\n\nks-newsletter-popup ks-input-check {\n    margin: 20px;\n\n    font-size: 13px;\n    line-height: 18px;\n}\n\nks-newsletter-popup .email-form {\n    display: flex;\n}\n\nks-newsletter-popup .email-form > * { margin-bottom: 0px; }\nks-newsletter-popup .email-form > * input { height: 60px; }\nks-newsletter-popup .email-form > ks-button { width: 30%; }\nks-newsletter-popup .email-form > ks-input-text { width: 100%; }\n\nks-newsletter-popup .email {\n    flex: 1 0 0;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    background-color: #e5e5e5;\n    color: black;\n    font-size: 18px;\n    min-height: 50px;\n}\n\n@media (max-width: 720px) {\n    ks-newsletter-popup .info .heading {\n        max-height: 50px;\n    }\n\n    ks-newsletter-popup .email {\n        font-size: 16px;\n    }\n}\n\n@media (max-width: 540px) {\n    ks-newsletter-popup .info {\n        padding: 70px 25px 20px 25px;\n        min-height: 180px;\n    }\n\n    ks-newsletter-popup .info .top {\n        display: none;\n    }\n\n    ks-newsletter-popup .info p {\n        font-size: 13px;\n    }\n\n    ks-newsletter-popup ks-input-check {\n        font-size: 11px;\n        line-height: 16px;\n    }\n\n    ks-newsletter-popup .email-form {\n        display: block;\n    }\n    \n    ks-newsletter-popup .email-form > ks-button { width: 100%; }\n\n    ks-newsletter-popup .buttons { \n        display: block;\n        margin-top: 0px;\n    }\n    ks-newsletter-popup .buttons > *:first-child { border-bottom: 1px solid #3a3a3a; }\n\n    ks-newsletter-popup ks-input-check {\n        margin: 15px;\n    }\n\n    ks-newsletter-popup .info .heading {\n        width: 100%;\n        max-height: 40px;\n    }\n}","import { Component, h, Prop, Element, Method } from '@stencil/core';\nimport ValidateInput from '../../input/validate';\ndeclare var ksNewsletterToken: any;\n\nimport { commonDynamic, SubscriptionData } from \"../../../global/data/commonDynamic\";\nimport { DataLayer } from '../../../global/dataLayer';\n\n@Component({\n  tag: 'ks-newsletter-popup',\n  styleUrl: 'newsletter-popup.css'\n})\nexport class NewsletterPopup{\n    @Element() root: HTMLElement;\n    dialog: HTMLKsDialogElement;\n\n    @Prop() api: string;\n    @Prop() loginLink: string;\n    @Prop() registerLink: string;\n\n    @Prop() displayOnLoad: boolean = false;\n\n    @Prop() loggedIn: boolean = false;\n    @Prop({mutable: true}) subscribed: boolean = false;\n    @Prop() email: string;\n\n    @Prop() agreement: string = \"Wyrażam zgodę na przetwarzanie danych osobowych do celów marketingowych, w celu zbadania opinii o sklepie oraz na otrzymywanie informacji handlowych na wskazany przeze mnie adres e-mail.\";\n    @Prop() infoMessage: string = \"Aby otrzymać kupon rabatowy musisz posiadać konto w naszym sklepie. Minimalna wartość zamówienia wynosi: 100,00 zł\";\n\n    @Prop() successHeading: string = \"ZAPISANO DO NEWSLETTERA\";\n    @Prop() successUnsubHeading: string = \"WYPISANO Z NEWSLETTERA\";\n    @Prop() faliureHeading: string = \"BŁĄD ZAPISU\";\n\n    success = false;\n\n    componentDidLoad() {\n        this.dialog = this.root.querySelector(\"ks-dialog\");\n        if(this.displayOnLoad && document.cookie.search(\"newsletterPopup=tak\") == -1) {\n            setTimeout(() => {\n                this.Show();\n            }, 4000);\n        }\n    }\n\n    async requestHandler(event: Event) {\n        event.preventDefault();\n        if(!await ValidateInput(this.root.querySelector('form')))\n            return;\n\n        this.dialog.showLoading();\n\n        const target = event.target as HTMLFormElement;\n        const data = new FormData(target);\n\n        if(this.subscribed)\n        data.append(\"unsubscribe\", \"1\");\n        data.append(\"email\", this.email);\n        data.append(\"popup\", \"1\");\n\n        fetch(this.api, { body: data, method: \"post\"})\n        .then(async response => {\n            const result = await response.text();\n            if(result.search(\"SUCCESS\") != -1) {\n                const heading = this.subscribed ? this.successUnsubHeading : this.successHeading;\n                this.dialog.showSuccess(heading, result.replace(\"SUCCESS\", \"\"));\n                this.track();\n                this.success = true;\n            }\n            else this.dialog.showFailure(this.faliureHeading, result);\n        })\n        .catch(async error => {\n            let message = \"\";\n\n            if(!window.navigator.onLine)\n                message = \"Brak internetu.\"\n\n            if(error.message) message = error.message;\n\n            this.dialog.showFailure(this.faliureHeading, message);\n        });\n    }\n\n    track() {\n        const data: SubscriptionData = {\n            email: this.email,\n            subscriber: !this.subscribed,\n            place: \"Zapis do newslettera | Popup\"\n        }\n\n        DataLayer.subscribe(data);\n    }\n\n    setSubscription() {\n        let customer = commonDynamic.get('customer');\n        customer.subscriber = !this.subscribed;\n        commonDynamic.set('customer', customer);\n        this.subscribed = !this.subscribed;\n    }\n    \n\n    @Method()\n    async Show() {\n        this.dialog.show();\n    }\n\n    SetCookie() {\n        var expiration = \"\";\n        var expirationDate = new Date();\n        expirationDate.setMonth(expirationDate.getMonth() + 1);\n        expiration = \"expires=\" + expirationDate.toUTCString() + \"; \";\n\n        document.cookie = \"newsletterPopup=tak; \" + expiration + \"path=/\";\n\n        if(this.success) {\n            this.setSubscription();\n            this.success = false;\n        }\n    }\n    \n\n  render() {\n    return [\n        <ks-dialog dark smallmobile nopadding onClosed={()=>this.SetCookie()}>\n            <form onSubmit={e => this.requestHandler(e)}>\n                <div class=\"info\">\n                    <svg class=\"top\" viewBox=\"0 0 303 15\" width={909} height={45}>\n                        <text x=\"0\" y=\"12\">Zapisz się do naszego Newslettera i zyskaj</text>\n                    </svg>\n\n                    <svg class=\"heading\" viewBox=\"0 0 96 12\" width={960} height={130}>\n                        <text x=\"-1\" y=\"12\">KUPON 10ZŁ</text>\n                    </svg>\n\n                    <p>{this.infoMessage}</p>\n                </div>\n                    \n                {!this.loggedIn ?\n                    <div class=\"buttons\">\n                        <ks-button tall name=\"ZALOGUJ SIĘ\" link={this.loginLink}></ks-button>\n                        <ks-button tall name=\"NOWE KONTO\" link={this.registerLink}></ks-button>\n                    </div>\n                : [\n                    this.subscribed ? null : <ks-input-check large required nomessage name=\"zgoda\" label={this.agreement} />,\n                    <div class=\"email-form\">\n                        <div class=\"email\">{this.email}</div>\n                        <ks-button submit secondary={this.subscribed} name={this.subscribed ? \"WYPISZ SIĘ\" : \"ZAPISZ SIĘ\"} />\n                    </div>\n                ]}\n            </form>\n        </ks-dialog>\n    ];\n  }\n}\n"],"names":[],"mappings":"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"}
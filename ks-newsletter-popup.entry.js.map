{"version":3,"names":["newsletterPopupCss","NewsletterPopup","this","success","componentDidLoad","dialog","root","querySelector","displayOnLoad","document","cookie","search","setTimeout","Show","async","event","preventDefault","ValidateInput","showLoading","target","data","FormData","subscribed","append","email","fetch","api","body","method","then","response","result","text","heading","successUnsubHeading","successHeading","showSuccess","replace","track","showFailure","faliureHeading","catch","error","message","window","navigator","onLine","subscriber","place","DataLayer","subscribe","setSubscription","customer","commonDynamic","get","set","show","SetCookie","expiration","expirationDate","Date","setMonth","getMonth","toUTCString","render","h","dark","smallmobile","nopadding","onClosed","onSubmit","e","requestHandler","class","viewBox","width","height","x","y","infoMessage","loggedIn","tall","name","link","loginLink","registerLink","large","required","nomessage","label","agreement","submit","secondary"],"sources":["src/components/base/popups/newsletter-popup.css?tag=ks-newsletter-popup","src/components/base/popups/newsletter-popup.tsx"],"sourcesContent":["ks-newsletter-popup {\n    display: block;\n}\n\nks-newsletter-popup form {\n    display: flex;\n    flex-direction: column;\n    justify-content: space-between;\n\n    height: 100%;\n    width: 100%;\n    max-width: 720px;\n}\n\nks-newsletter-popup .info {\n    padding: 60px 60px 20px 60px;\n    fill: #252525;\n\n    flex: 1 0 auto;\n    min-height: 10px;\n}\n\nks-newsletter-popup .info .top {\n    width: 100%;\n    margin-bottom: 10px;\n    font-size: initial;\n    max-height: 30px;\n}\n\nks-newsletter-popup .info .heading {\n    width: 100%;\n    font-family: var(--font-emphasis);\n    font-size: initial;\n    max-height: 80px;\n    margin-bottom: 10px;\n}\n\nks-newsletter-popup .info p {\n    text-align: center;\n    margin-top: 10px;\n}\n\nks-newsletter-popup .buttons {\n    display: flex;\n    flex-wrap: wrap;\n    min-height: 10px;\n    margin-top: 30px;\n}\n\nks-newsletter-popup .buttons > * {\n    flex: 1;\n}\n\nks-newsletter-popup .close {\n    color: black !important;\n}\n\nks-newsletter-popup ks-input-check {\n    margin: 20px;\n\n    font-size: 13px;\n    line-height: 18px;\n}\n\nks-newsletter-popup .email-form {\n    display: flex;\n}\n\nks-newsletter-popup .email-form > * { margin-bottom: 0px; }\nks-newsletter-popup .email-form > * input { height: 60px; }\nks-newsletter-popup .email-form > ks-button { width: 30%; }\nks-newsletter-popup .email-form > ks-input-text { width: 100%; }\n\nks-newsletter-popup .email {\n    flex: 1 0 0;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    background-color: #e5e5e5;\n    color: black;\n    font-size: 18px;\n    min-height: 50px;\n}\n\n@media (max-width: 720px) {\n    ks-newsletter-popup .info .heading {\n        max-height: 50px;\n    }\n\n    ks-newsletter-popup .email {\n        font-size: 16px;\n    }\n}\n\n@media (max-width: 540px) {\n    ks-newsletter-popup .info {\n        padding: 70px 25px 20px 25px;\n        min-height: 180px;\n    }\n\n    ks-newsletter-popup .info .top {\n        display: none;\n    }\n\n    ks-newsletter-popup .info p {\n        font-size: 13px;\n    }\n\n    ks-newsletter-popup ks-input-check {\n        font-size: 11px;\n        line-height: 16px;\n    }\n\n    ks-newsletter-popup .email-form {\n        display: block;\n    }\n    \n    ks-newsletter-popup .email-form > ks-button { width: 100%; }\n\n    ks-newsletter-popup .buttons { \n        display: block;\n        margin-top: 0px;\n    }\n    ks-newsletter-popup .buttons > *:first-child { border-bottom: 1px solid #3a3a3a; }\n\n    ks-newsletter-popup ks-input-check {\n        margin: 15px;\n    }\n\n    ks-newsletter-popup .info .heading {\n        width: 100%;\n        max-height: 40px;\n    }\n}","import { Component, h, Prop, Element, Method } from '@stencil/core';\nimport ValidateInput from '../../input/validate';\ndeclare var ksNewsletterToken: any;\n\nimport { commonDynamic, SubscriptionData } from \"../../../global/data/commonDynamic\";\nimport { DataLayer } from '../../../global/dataLayer';\n\n@Component({\n  tag: 'ks-newsletter-popup',\n  styleUrl: 'newsletter-popup.css'\n})\nexport class NewsletterPopup{\n    @Element() root: HTMLElement;\n    dialog: HTMLKsDialogElement;\n\n    @Prop() api: string;\n    @Prop() loginLink: string;\n    @Prop() registerLink: string;\n\n    @Prop() displayOnLoad: boolean = false;\n\n    @Prop() loggedIn: boolean = false;\n    @Prop({mutable: true}) subscribed: boolean = false;\n    @Prop() email: string;\n\n    @Prop() agreement: string = \"Wyrażam zgodę na przetwarzanie danych osobowych do celów marketingowych, w celu zbadania opinii o sklepie oraz na otrzymywanie informacji handlowych na wskazany przeze mnie adres e-mail.\";\n    @Prop() infoMessage: string = \"Aby otrzymać kupon rabatowy musisz posiadać konto w naszym sklepie. Minimalna wartość zamówienia wynosi: 100,00 zł\";\n\n    @Prop() successHeading: string = \"ZAPISANO DO NEWSLETTERA\";\n    @Prop() successUnsubHeading: string = \"WYPISANO Z NEWSLETTERA\";\n    @Prop() faliureHeading: string = \"BŁĄD ZAPISU\";\n\n    success = false;\n\n    componentDidLoad() {\n        this.dialog = this.root.querySelector(\"ks-dialog\");\n        if(this.displayOnLoad && document.cookie.search(\"newsletterPopup=tak\") == -1) {\n            setTimeout(() => {\n                this.Show();\n            }, 4000);\n        }\n    }\n\n    async requestHandler(event: Event) {\n        event.preventDefault();\n        if(!await ValidateInput(this.root.querySelector('form')))\n            return;\n\n        this.dialog.showLoading();\n\n        const target = event.target as HTMLFormElement;\n        const data = new FormData(target);\n\n        if(this.subscribed)\n        data.append(\"unsubscribe\", \"1\");\n        data.append(\"email\", this.email);\n        data.append(\"popup\", \"1\");\n\n        fetch(this.api, { body: data, method: \"post\"})\n        .then(async response => {\n            const result = await response.text();\n            if(result.search(\"SUCCESS\") != -1) {\n                const heading = this.subscribed ? this.successUnsubHeading : this.successHeading;\n                this.dialog.showSuccess(heading, result.replace(\"SUCCESS\", \"\"));\n                this.track();\n                this.success = true;\n            }\n            else this.dialog.showFailure(this.faliureHeading, result);\n        })\n        .catch(async error => {\n            let message = \"\";\n\n            if(!window.navigator.onLine)\n                message = \"Brak internetu.\"\n\n            if(error.message) message = error.message;\n\n            this.dialog.showFailure(this.faliureHeading, message);\n        });\n    }\n\n    track() {\n        const data: SubscriptionData = {\n            email: this.email,\n            subscriber: !this.subscribed,\n            place: \"Zapis do newslettera | Popup\"\n        }\n\n        DataLayer.subscribe(data);\n    }\n\n    setSubscription() {\n        let customer = commonDynamic.get('customer');\n        customer.subscriber = !this.subscribed;\n        commonDynamic.set('customer', customer);\n        this.subscribed = !this.subscribed;\n    }\n    \n\n    @Method()\n    async Show() {\n        this.dialog.show();\n    }\n\n    SetCookie() {\n        var expiration = \"\";\n        var expirationDate = new Date();\n        expirationDate.setMonth(expirationDate.getMonth() + 1);\n        expiration = \"expires=\" + expirationDate.toUTCString() + \"; \";\n\n        document.cookie = \"newsletterPopup=tak; \" + expiration + \"path=/\";\n\n        if(this.success) {\n            this.setSubscription();\n            this.success = false;\n        }\n    }\n    \n\n  render() {\n    return [\n        <ks-dialog dark smallmobile nopadding onClosed={()=>this.SetCookie()}>\n            <form onSubmit={e => this.requestHandler(e)}>\n                <div class=\"info\">\n                    <svg class=\"top\" viewBox=\"0 0 303 15\" width={909} height={45}>\n                        <text x=\"0\" y=\"12\">Zapisz się do naszego Newslettera i zyskaj</text>\n                    </svg>\n\n                    <svg class=\"heading\" viewBox=\"0 0 96 12\" width={960} height={130}>\n                        <text x=\"-1\" y=\"12\">KUPON 10ZŁ</text>\n                    </svg>\n\n                    <p>{this.infoMessage}</p>\n                </div>\n                    \n                {!this.loggedIn ?\n                    <div class=\"buttons\">\n                        <ks-button tall name=\"ZALOGUJ SIĘ\" link={this.loginLink}></ks-button>\n                        <ks-button tall name=\"NOWE KONTO\" link={this.registerLink}></ks-button>\n                    </div>\n                : [\n                    this.subscribed ? null : <ks-input-check large required nomessage name=\"zgoda\" label={this.agreement} />,\n                    <div class=\"email-form\">\n                        <div class=\"email\">{this.email}</div>\n                        <ks-button submit secondary={this.subscribed} name={this.subscribed ? \"WYPISZ SIĘ\" : \"ZAPISZ SIĘ\"} />\n                    </div>\n                ]}\n            </form>\n        </ks-dialog>\n    ];\n  }\n}\n"],"mappings":"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"}
import{f as n,j as t}from"./fetch-7fa5b910.js";import{c as a}from"./commonDynamic-5e51121d.js";import{c as i}from"./cart-b9df7a0c.js";async function o(n){const t=await P((async()=>j(i.get("api").productRemove,{id:n})));t&&(0==t.products.length?document.location.reload():h("Błąd usuwania produktu",t,(async n=>{v(n),"discount"in n==0&&this.RemoveDiscount()})));const a=document.querySelector(`ks-cart-product[ikey="${n}"]`);a&&a.ResetLoading()}var c={};async function s(n,t,a){c[n]?c[n]=()=>e(n,t,a):(c[n]=()=>{},e(n,t,a).then((()=>{c[n]&&(c[n](),c[n]=void 0)})))}async function e(n,t,a){const o=await P((async()=>j(i.get("api").productCount,{id:n,ilosc:t.toString()})));o?h("Błąd ilości produktu",o,(async t=>{"error"in t?(T().show("Błąd ilości produktu",t.error.message),i.set("products",r(n,t.error.amount,t.error.maxAmount))):await v(t),"discount"in t==0&&l()})):(i.set("products",r(n,a)),this.SetAmount(a,`ks-cart-product[ikey="${n}"] ks-cart-spinner`))}function r(n,t,a){const o=i.get("products");return o[n].quantity=t,a&&(o[n].maxQuantity=a),o}async function u(n){i.set("loadingDeals",!0);const t=await j(i.get("api").addDeal,{id:n});if(i.set("loadingDeals",!1),t&&!("error"in t)){await v(t);for(const n in i.get("products")){const t=i.get("products")[n],a=document.querySelector(`ks-cart-product[product-id="${t.id}"] ks-cart-spinner`);null==a||a.SetAmount(t.quantity)}}else T().show("Błąd dodawania gratisu",t.error.message)}async function d(n){b("ks-cart-select-shipping"),b("ks-cart-select-payment"),v(await j(i.get("api").countryChange,{data:n})),$("ks-cart-select-shipping"),$("ks-cart-select-payment")}async function p(n){b("ks-cart-select-payment"),v(await j(i.get("api").shippingChange,{data:n.toString()})),$("ks-cart-select-payment")}async function w(n){v(await j(i.get("api").paymentChange,{data:n.toString()}))}async function f(){v(await j(i.get("api").discountRemove)),l()}function l(){i.set("discount",{})}async function m(n){h("Błąd dodawania kodu",await j(i.get("api").discountCode,{data:n}),(n=>{v(n)})),$("ks-cart-discount-code")}async function y(n){const t=await j(i.get("api").discountPoints,{data:n.toString()});!function(){const n=document.querySelectorAll("ks-cart-discount-container ks-cart-heading");let t=0;2==n.length&&(t=n[1].getBoundingClientRect().top-n[0].getBoundingClientRect().top),t&&window.scrollBy(0,-t)}(),v(t),$("ks-cart-discount-points")}async function g(n){const a=i.get("api").easyprotectChange;B(),await t(a,n).then((n=>n.json())).then((n=>v(n))),C()}async function k(t){const a=i.get("api").easyprotectRemove;B(),await n(a,{id:t}).then((n=>n.json())).then((n=>v(n))),C()}function b(n){const t=document.querySelector(n);t&&"StartLoading"in t&&t.StartLoading()}function $(n){const t=document.querySelector(n);t&&"ResetLoading"in t&&t.ResetLoading()}async function h(n,t,a){"message"in t?(T().show(n,t.message),delete t.message,setTimeout((()=>{a(t)}),200)):a(t)}async function P(n){i.set("loadingProducts",i.get("loadingProducts")+1);const t=await n();return i.set("loadingProducts",i.get("loadingProducts")-1),t}async function j(t,a){return B(),n(t,a).then((n=>n.json())).then((n=>(C(),n))).catch((n=>(C(),document.querySelector("ks-error-popup").show(n),{})))}function v(n){Object.keys(n).map((t=>{i.set(t,n[t])})),x(0)}function B(){i.set("loading",i.get("loading")+1)}function C(){i.set("loading",i.get("loading")-1)}function T(){return document.querySelector("ks-message-popup")}function D(){const n=a.get("api").inpostFrontend;return t(`${n}/getbinding`,{}).then((n=>n.json()))}window.iziGetPayData=(n,i,o)=>{const c=a.get("api").inpostFrontend,s=window.iziGetBrowserData();return t(`${c}/getpaydata`,{browser:s,phonePrefix:n,phoneNumber:i,bindingPlace:o}).then((n=>n.json()))};var O=new AbortController;function x(n){window.iziCanBeBound(n).then((t=>t?window.iziAddToCart(n):null))}window.iziGetIsBound=()=>{const n=a.get("api").inpostFrontend;return async function(n,t=0,a=200){const i=async(o,c,s)=>{if(t>0&&s>=t)return void c();const e=await n();e&&0!==Object.keys(e).length?o(e):setTimeout((()=>i(o,c,s+1)),a)};return new Promise(((n,t)=>i(n,t,0)))}((()=>t(`${n}/isbound`,{}).then((n=>n.json())).catch((()=>null))),0,1500).then((n=>(Object.keys(n).length>0&&function(){const n=a.get("api").inpostFrontend,o=()=>t(`${n}/detectchanges`,{},O.signal).then((n=>n.json())).then((n=>{n.cartUpdated&&(async function(){v(await j(i.get("api").reload))}(),setTimeout(o,500))}));setTimeout(o,1500)}(),n)))},window.iziGetOrderComplete=()=>Promise.resolve({action:"string",redirect:"string"}),window.iziBindingDelete=()=>{const n=a.get("api").inpostFrontend;return t(`${n}/bindingdelete`,{}).then((n=>n.json()))},window.iziCanBeBound=n=>{const i=a.get("api").inpostFrontend;return t(`${i}/canbebound`,{product_id:n}).then((n=>n.json()))},window.iziAddToCart=n=>{const i=a.get("api").inpostFrontend;return t(`${i}/addtocart`,{product_id:n}).then((n=>n.json())).then((n=>function(n){console.log("InpostUpdateCount");const t=new CustomEvent("inpost-update-count",{detail:n});Array.from(document.getElementsByTagName("inpost-izi-button")).forEach((n=>n.dispatchEvent(t)))}(n.product_count)))},window.iziMobileLink=()=>{const n=a.get("api").inpostFrontend;return t(`${n}/mobilelink`,{}).then((n=>n.json()))};export{x as C,u as a,w as b,d as c,f as d,m as e,y as f,g,k as h,D as i,s as p,o as r,p as s,v as u}
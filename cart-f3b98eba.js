import{c as n}from"./cart-b9df7a0c.js";import{f as a,j as t}from"./fetch-bbb23998.js";import{C as c}from"./inpost-pay-32090c89.js";async function s(a){const t=await B((async()=>P(n.get("api").productRemove,{id:a})));t&&(0==t.products.length?document.location.reload():j("Błąd usuwania produktu",t,(async n=>{$(n),"discount"in n==0&&this.RemoveDiscount()})));const c=document.querySelector(`ks-cart-product[ikey="${a}"]`);c&&c.ResetLoading()}var i={};async function o(n,a,t){i[n]?i[n]=()=>u(n,a,t):(i[n]=()=>{},u(n,a,t).then((()=>{i[n]&&(i[n](),i[n]=void 0)})))}async function u(a,t,c){const s=await B((async()=>P(n.get("api").productCount,{id:a,ilosc:t.toString()})));s?j("Błąd ilości produktu",s,(async t=>{"error"in t?(L().show("Błąd ilości produktu",t.error.message),n.set("products",d(a,t.error.amount,t.error.maxAmount))):await $(t),"discount"in t==0&&y()})):(n.set("products",d(a,c)),this.SetAmount(c,`ks-cart-product[ikey="${a}"] ks-cart-spinner`))}function d(a,t,c){const s=n.get("products");return s[a].quantity=t,c&&(s[a].maxQuantity=c),s}async function r(a){n.set("loadingDeals",!0);const t=await P(n.get("api").addDeal,{id:a});if(n.set("loadingDeals",!1),t&&!("error"in t)){await $(t);for(const a in n.get("products")){const t=n.get("products")[a],c=document.querySelector(`ks-cart-product[product-id="${t.id}"] ks-cart-spinner`);null==c||c.SetAmount(t.quantity)}}else L().show("Błąd dodawania gratisu",t.error.message)}async function e(a){h("ks-cart-select-shipping"),h("ks-cart-select-payment"),$(await P(n.get("api").countryChange,{data:a})),b("ks-cart-select-shipping"),b("ks-cart-select-payment")}async function p(a){h("ks-cart-select-payment"),$(await P(n.get("api").shippingChange,{data:a.toString()})),b("ks-cart-select-payment")}async function f(a){$(await P(n.get("api").paymentChange,{data:a.toString()}))}async function l(){$(await P(n.get("api").discountRemove)),y()}function y(){n.set("discount",{})}async function k(a){j("Błąd dodawania kodu",await P(n.get("api").discountCode,{data:a}),(n=>{$(n)})),b("ks-cart-discount-code")}async function m(a){const t=await P(n.get("api").discountPoints,{data:a.toString()});!function(){const n=document.querySelectorAll("ks-cart-discount-container ks-cart-heading");let a=0;2==n.length&&(a=n[1].getBoundingClientRect().top-n[0].getBoundingClientRect().top),a&&window.scrollBy(0,-a)}(),$(t),b("ks-cart-discount-points")}async function g(a){const c=n.get("api").easyprotectChange;v(),await t(c,a).then((n=>n.json())).then((n=>$(n))),D()}async function w(t){const c=n.get("api").easyprotectRemove;v(),await a(c,{id:t}).then((n=>n.json())).then((n=>$(n))),D()}function h(n){const a=document.querySelector(n);a&&"StartLoading"in a&&a.StartLoading()}function b(n){const a=document.querySelector(n);a&&"ResetLoading"in a&&a.ResetLoading()}async function j(n,a,t){"message"in a?(L().show(n,a.message),delete a.message,setTimeout((()=>{t(a)}),200)):t(a)}async function B(a){n.set("loadingProducts",n.get("loadingProducts")+1);const t=await a();return n.set("loadingProducts",n.get("loadingProducts")-1),t}async function P(n,t){return v(),a(n,t).then((n=>n.json())).then((n=>(D(),n))).catch((n=>(D(),document.querySelector("ks-error-popup").show(n),{})))}function $(a){Object.keys(a).map((t=>{n.set(t,a[t])})),c(0)}function v(){n.set("loading",n.get("loading")+1)}function D(){n.set("loading",n.get("loading")-1)}function L(){return document.querySelector("ks-message-popup")}export{r as a,f as b,e as c,l as d,k as e,m as f,g,w as h,o as p,s as r,p as s,$ as u}
{"version":3,"names":["addToCart","product","place","errorpopup","document","querySelector","messagepopup","navbar","body","FormData","append","id","quantity","toString","name","currentPrice","traitIDs","api","commonDynamic","get","Fetch","then","data","__awaiter","_this","__generator","this","_a","json","status","productLink","show","message","link","IncrementCart","OpenSuggestions","DataLayer","event","catch","error","suggestions"],"sources":["src/global/functions/addToCart.ts"],"sourcesContent":["import { commonDynamic } from \"../data/commonDynamic\";\nimport { ProductShortData } from \"../data/product\";\nimport Fetch from \"./fetch\";\nimport { DataLayer } from \"../dataLayer\";\n\nexport async function addToCart(product: ProductShortData, place = 1) {\n    const errorpopup = document.querySelector('ks-error-popup') as HTMLKsErrorPopupElement;\n    const messagepopup = document.querySelector('ks-message-popup') as HTMLKsMessagePopupElement;\n    const navbar = document.querySelector('ks-navbar') as HTMLKsNavbarElement;\n\n    let body = new FormData();\n    body.append(\"id\", product.id);\n    body.append(\"ilosc\", product.quantity.toString());\n    body.append(\"nazwa\", product.name);\n    body.append(\"value\", product.currentPrice.toString());\n    body.append(\"cechy\", product.traitIDs);\n    body.append(\"akcja\", 'dodaj');\n    body.append(\"miejsce\", place.toString());\n\n    const api = commonDynamic.get('api').addToCart;\n    return Fetch(api, body)\n        .then(async data => data.json())\n        .then(async data => {\n            if(!data.status) {\n                if(data.productLink)\n                    messagepopup.show(\"Wymagany wybór cechy\", data.message, \"Przejdź do produktu\", product.link);\n                else messagepopup.show(\"Błąd dodawania produktu\", data.message);\n                return;\n            }\n    \n            navbar.IncrementCart(product.quantity.toString());\n            OpenSuggestions(product.id, product.name);\n\n            DataLayer.addToCart(product, data.event);\n        })\n        .catch(error => {\n            errorpopup.show(error);\n        });\n};\n\nfunction OpenSuggestions(id: string, name: string) {\n    const suggestions = document.querySelector(\"ks-product-suggestions\");\n    suggestions.show(id, name);\n}"],"mappings":"6sDAKO,SAAeA,EAAUC,EAA2BC,GAAA,GAAAA,SAAA,GAAAA,EAAA,CAAS,C,8GAC1DC,EAAaC,SAASC,cAAc,kBACpCC,EAAeF,SAASC,cAAc,oBACtCE,EAASH,SAASC,cAAc,aAElCG,EAAO,IAAIC,SACfD,EAAKE,OAAO,KAAMT,EAAQU,IAC1BH,EAAKE,OAAO,QAAST,EAAQW,SAASC,YACtCL,EAAKE,OAAO,QAAST,EAAQa,MAC7BN,EAAKE,OAAO,QAAST,EAAQc,aAAaF,YAC1CL,EAAKE,OAAO,QAAST,EAAQe,UAC7BR,EAAKE,OAAO,QAAS,SACrBF,EAAKE,OAAO,UAAWR,EAAMW,YAEvBI,EAAMC,EAAcC,IAAI,OAAOnB,UACrC,SAAOoB,EAAMH,EAAKT,GACba,MAAK,SAAMC,GAAI,OAAAC,UAAAC,OAAA,4BAAAC,YAAAC,MAAA,SAAAC,GAAI,SAAAL,EAAKM,O,UACxBP,MAAK,SAAMC,GAAI,OAAAC,UAAAC,OAAA,qB,qCACZ,IAAIF,EAAKO,OAAQ,CACb,GAAGP,EAAKQ,YACJxB,EAAayB,KAAK,uBAAwBT,EAAKU,QAAS,sBAAuB/B,EAAQgC,WACtF3B,EAAayB,KAAK,0BAA2BT,EAAKU,SACvD,S,CAGJzB,EAAO2B,cAAcjC,EAAQW,SAASC,YACtCsB,EAAgBlC,EAAQU,GAAIV,EAAQa,MAEpCsB,EAAUpC,UAAUC,EAASqB,EAAKe,O,mBAErCC,OAAM,SAAAC,GACHpC,EAAW4B,KAAKQ,E,WAI5B,SAASJ,EAAgBxB,EAAYG,GACjC,IAAM0B,EAAcpC,SAASC,cAAc,0BAC3CmC,EAAYT,KAAKpB,EAAIG,EACzB,C"}